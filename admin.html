<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eldavily Admin Panel</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #2b2b2b;
            --primary-color: #1a1a1a;
            --accent-color: #c9a96d;
            --card-shadow: 0 5px 25px rgba(0, 0, 0, 0.07);
            --font-primary: 'Playfair Display', serif;
            --font-secondary: 'Montserrat', sans-serif;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --border-radius: 8px;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: var(--font-secondary); 
        }
        
        body { 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            min-height: 100vh; 
            line-height: 1.7;
        }

        /* Login Styles */
        .login-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            background: linear-gradient(135deg, #1a1a1a 0%, #2c3e50 100%); 
        }
        
        .login-form { 
            background: white; 
            padding: 40px; 
            border-radius: var(--border-radius); 
            box-shadow: var(--card-shadow); 
            width: 100%; 
            max-width: 400px; 
        }
        
        .login-form h2 { 
            text-align: center; 
            margin-bottom: 30px; 
            color: var(--primary-color); 
            font-family: var(--font-primary);
            font-size: 32px;
        }
        
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 500; 
            color: #444; 
        }
        
        .form-control { 
            width: 100%; 
            padding: 12px 15px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            font-size: 1rem; 
            transition: border-color 0.3s; 
            font-family: var(--font-secondary);
        }
        
        .form-control:focus { 
            outline: none; 
            border-color: var(--accent-color); 
        }
        
        .btn { 
            padding: 12px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: 500; 
            transition: all 0.3s; 
            font-family: var(--font-secondary);
        }
        
        .btn-primary { 
            background-color: var(--accent-color); 
            color: white; 
        }
        
        .btn-primary:hover { 
            background-color: #b89a5f; 
        }
        
        .btn-sm { 
            padding: 8px 15px; 
            font-size: 0.9rem; 
        }
        
        .error-message { 
            color: var(--danger-color); 
            font-size: 0.9rem; 
            margin-top: 10px; 
            text-align: center; 
        }

        /* Admin Panel Styles */
        .admin-panel { 
            display: none; 
            min-height: 100vh; 
        }
        
        .sidebar { 
            width: 260px; 
            background-color: var(--primary-color); 
            color: white; 
            position: fixed; 
            height: 100vh; 
            overflow-y: auto; 
            z-index: 1000; 
        }
        
        .sidebar-header { 
            padding: 20px; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        .sidebar-header h2 { 
            font-size: 1.5rem; 
            font-weight: 600; 
            font-family: var(--font-primary);
        }
        
        .sidebar-header i { 
            color: var(--accent-color); 
            font-size: 1.8rem; 
        }
        
        .sidebar-menu { 
            padding: 15px 0; 
        }
        
        .menu-item { 
            padding: 12px 20px; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            cursor: pointer; 
            transition: all 0.2s; 
            border-left: 4px solid transparent; 
        }
        
        .menu-item:hover, .menu-item.active { 
            background-color: rgba(255, 255, 255, 0.1); 
            border-left: 4px solid var(--accent-color); 
        }
        
        .menu-item i { 
            width: 20px; 
            text-align: center; 
        }
        
        .main-content { 
            margin-left: 260px; 
            padding: 20px; 
        }
        
        .top-bar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 0; 
            margin-bottom: 25px; 
            border-bottom: 1px solid #e0e0e0; 
        }
        
        .user-info { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        .user-avatar { 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            background-color: var(--accent-color); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-weight: bold; 
        }
        
        .logout-btn { 
            background: none; 
            border: 1px solid var(--danger-color); 
            color: var(--danger-color); 
            padding: 8px 15px; 
            border-radius: 4px; 
            cursor: pointer; 
            transition: all 0.3s; 
        }
        
        .logout-btn:hover { 
            background-color: var(--danger-color); 
            color: white; 
        }
        
        .dashboard-cards { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        
        .card { 
            background-color: var(--bg-color); 
            border-radius: var(--border-radius); 
            box-shadow: var(--card-shadow); 
            padding: 20px; 
            transition: transform 0.3s; 
        }
        
        .card:hover { 
            transform: translateY(-5px); 
        }
        
        .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        
        .card-title { 
            font-size: 1.1rem; 
            font-weight: 600; 
            color: var(--primary-color); 
        }
        
        .card-icon { 
            width: 50px; 
            height: 50px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.5rem; 
        }
        
        .bg-primary { 
            background-color: rgba(26, 26, 26, 0.1); 
            color: var(--primary-color); 
        }
        
        .bg-success { 
            background-color: rgba(40, 167, 69, 0.1); 
            color: var(--success-color); 
        }
        
        .bg-warning { 
            background-color: rgba(255, 193, 7, 0.1); 
            color: var(--warning-color); 
        }
        
        .bg-danger { 
            background-color: rgba(220, 53, 69, 0.1); 
            color: var(--danger-color); 
        }
        
        .bg-info { 
            background-color: rgba(23, 162, 184, 0.1); 
            color: var(--info-color); 
        }
        
        .card-value { 
            font-size: 2rem; 
            font-weight: 700; 
            margin-bottom: 5px; 
            font-family: var(--font-primary);
        }
        
        .card-desc { 
            color: #666; 
            font-size: 0.9rem; 
        }
        
        .content-section { 
            background-color: var(--bg-color); 
            border-radius: var(--border-radius); 
            box-shadow: var(--card-shadow); 
            padding: 25px; 
            margin-bottom: 30px; 
        }
        
        .section-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
            padding-bottom: 15px; 
            border-bottom: 1px solid #eee; 
        }
        
        .section-title { 
            font-size: 1.3rem; 
            font-weight: 600; 
            color: var(--primary-color); 
            font-family: var(--font-primary);
        }
        
        .section-actions button { 
            padding: 8px 15px; 
            border: none; 
            border-radius: 4px; 
            background-color: var(--accent-color); 
            color: white; 
            cursor: pointer; 
            font-weight: 500; 
            transition: background-color 0.3s; 
        }
        
        .section-actions button:hover { 
            background-color: #b89a5f; 
        }
        
        textarea.form-control { 
            min-height: 120px; 
            resize: vertical; 
        }
        
        .btn-success { 
            background-color: var(--success-color); 
            color: white; 
        }
        
        .btn-success:hover { 
            background-color: #218838; 
        }
        
        .preview-container { 
            border: 1px solid #eee; 
            border-radius: 4px; 
            padding: 15px; 
            margin-top: 15px; 
            background-color: #f9f9f9; 
            min-height: 100px; 
        }
        
        .tabs { 
            display: flex; 
            border-bottom: 1px solid #eee; 
            margin-bottom: 20px; 
        }
        
        .tab { 
            padding: 10px 20px; 
            cursor: pointer; 
            border-bottom: 3px solid transparent; 
            transition: all 0.3s; 
        }
        
        .tab.active { 
            border-bottom-color: var(--accent-color); 
            color: var(--accent-color); 
            font-weight: 500; 
        }
        
        .tab-content { 
            display: none; 
        }
        
        .tab-content.active { 
            display: block; 
        }
        
        .loading { 
            text-align: center; 
            padding: 20px; 
            color: #666; 
        }
        
        /* Modal and List Styles */
        .modal-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.6); 
            z-index: 2000; 
            display: none; 
            justify-content: center; 
            align-items: center; 
        }
        
        .modal-content { 
            background: white; 
            padding: 30px; 
            border-radius: var(--border-radius); 
            width: 90%; 
            max-width: 800px; 
            position: relative; 
            max-height: 90vh; 
            overflow-y: auto; 
        }
        
        .modal-close { 
            position: absolute; 
            top: 15px; 
            right: 20px; 
            font-size: 24px; 
            cursor: pointer; 
            color: #888; 
        }
        
        .list-item { 
            border: 1px solid #eee; 
            border-radius: var(--border-radius); 
            padding: 15px; 
            margin-bottom: 15px; 
        }
        
        .status-badge { 
            padding: 4px 8px; 
            border-radius: 12px; 
            font-size: 0.8em; 
            font-weight: bold; 
            color: white; 
            margin-left: 10px; 
        }
        
        .status-pending { 
            background-color: var(--warning-color); 
        }
        
        .status-confirmed { 
            background-color: var(--info-color); 
        }
        
        .status-shipped { 
            background-color: #17a2b8; 
        }
        
        .status-delivered { 
            background-color: var(--success-color); 
        }
        
        .status-cancelled { 
            background-color: var(--danger-color); 
        }
        
        .status-returned { 
            background-color: var(--danger-color); 
        }
        
        .status-read { 
            background-color: var(--success-color); 
        }
        
        .status-unread { 
            background-color: var(--warning-color); 
        }
        
        .status-active { 
            background-color: var(--success-color); 
        }
        
        .status-expired { 
            background-color: #6c757d; 
        }

        /* Order Card Styles */
        .order-card { 
            padding: 20px; 
            display: grid; 
            gap: 15px; 
            margin-bottom: 20px; 
        }
        
        .order-header, .order-details { 
            display: flex; 
            justify-content: space-between; 
            flex-wrap: wrap; 
            gap: 10px; 
        }
        
        .order-actions { 
            display: flex; 
            gap: 10px; 
            justify-content: flex-end; 
            align-items: center; 
        }

        /* Order Details Styles */
        .order-details-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-top: 20px; 
        }
        
        .order-info, .customer-info { 
            background: #f9f9f9; 
            padding: 15px; 
            border-radius: var(--border-radius); 
        }
        
        .order-info h4, .customer-info h4 { 
            margin-bottom: 15px; 
            color: var(--primary-color); 
            font-family: var(--font-primary);
        }
        
        .order-items { 
            margin-top: 20px; 
        }
        
        .order-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px 0; 
            border-bottom: 1px solid #eee; 
        }
        
        .order-item:last-child { 
            border-bottom: none; 
        }
        
        .order-status-select { 
            width: 100%; 
            padding: 8px; 
            border-radius: 4px; 
            border: 1px solid #ddd; 
            margin-top: 10px; 
        }
        
        .order-actions-buttons { 
            display: flex; 
            justify-content: flex-end; 
            gap: 10px; 
            margin-top: 20px; 
        }

        /* Statistics Styles */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        
        .stats-card { 
            background-color: var(--bg-color); 
            border-radius: var(--border-radius); 
            box-shadow: var(--card-shadow); 
            padding: 20px; 
        }
        
        .stats-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        
        .stats-title { 
            font-size: 1.1rem; 
            font-weight: 600; 
            color: var(--primary-color); 
        }
        
        .stats-value { 
            font-size: 2rem; 
            font-weight: 700; 
            margin-bottom: 10px; 
            font-family: var(--font-primary);
        }
        
        .stats-change { 
            font-size: 0.9rem; 
            display: flex; 
            align-items: center; 
        }
        
        .positive { 
            color: var(--success-color); 
        }
        
        .negative { 
            color: var(--danger-color); 
        }
        
        .chart-container { 
            height: 200px; 
            margin-top: 15px; 
        }
        
        .stats-list { 
            margin-top: 15px; 
        }
        
        .stats-list-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px 0; 
            border-bottom: 1px solid #eee; 
        }
        
        .stats-list-item:last-child { 
            border-bottom: none; 
        }
        
        .date-filter { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        
        .date-filter button { 
            padding: 8px 15px; 
            border: 1px solid #ddd; 
            background: white; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        
        .date-filter button.active { 
            background-color: var(--accent-color); 
            color: white; 
            border-color: var(--accent-color); 
        }

        /* Data Export Styles */
        .export-options { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        
        .export-btn { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            padding: 10px 15px; 
            background-color: var(--success-color); 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            transition: all 0.3s; 
        }
        
        .export-btn:hover { 
            background-color: #218838; 
        }
        
        .export-btn.pdf { 
            background-color: #dc3545; 
        }
        
        .export-btn.pdf:hover { 
            background-color: #c82333; 
        }
        
        .export-btn.excel { 
            background-color: #28a745; 
        }
        
        .export-btn.excel:hover { 
            background-color: #218838; 
        }
        
        /* Table Styles */
        .data-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 15px; 
        }
        
        .data-table th, .data-table td { 
            padding: 12px 15px; 
            text-align: left; 
            border-bottom: 1px solid #eee; 
        }
        
        .data-table th { 
            background-color: #f8f9fa; 
            font-weight: 600; 
            color: var(--primary-color); 
        }
        
        .data-table tr:hover { 
            background-color: #f8f9fa; 
        }
        
        .table-container { 
            overflow-x: auto; 
        }
        
        /* Stock Management Styles */
        .stock-info { 
            display: flex; 
            align-items: center; 
            gap: 5px; 
        }
        
        .stock-low { 
            color: var(--danger-color); 
            font-weight: bold; 
        }
        
        .stock-medium { 
            color: var(--warning-color); 
        }
        
        .stock-high { 
            color: var(--success-color); 
        }
        
        .stock-actions { 
            display: flex; 
            gap: 5px; 
        }
        
        .stock-input { 
            width: 80px; 
            padding: 5px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }

        /* Contact Messages Styles */
        .message-item { 
            border: 1px solid #eee; 
            border-radius: var(--border-radius); 
            padding: 15px; 
            margin-bottom: 15px; 
            background: #f9f9f9; 
        }
        
        .message-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        
        .message-sender { 
            font-weight: bold; 
            color: var(--primary-color); 
        }
        
        .message-date { 
            color: #666; 
            font-size: 0.9rem; 
        }
        
        .message-content { 
            margin-bottom: 10px; 
        }
        
        .message-actions { 
            display: flex; 
            gap: 10px; 
        }

        /* Coupons Management Styles */
        .coupons-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-top: 20px; 
        }
        
        .coupon-card { 
            background: white; 
            border-radius: var(--border-radius); 
            box-shadow: var(--card-shadow); 
            padding: 20px; 
            border-left: 4px solid var(--accent-color); 
        }
        
        .coupon-code { 
            font-size: 1.2rem; 
            font-weight: bold; 
            color: var(--primary-color); 
            margin-bottom: 10px; 
        }
        
        .coupon-discount { 
            font-size: 1.5rem; 
            color: var(--success-color); 
            font-weight: bold; 
        }
        
        .coupon-actions { 
            display: flex; 
            gap: 10px; 
            margin-top: 15px; 
        }

        /* Theme Settings Styles */
        .theme-options { 
            display: flex; 
            gap: 20px; 
            margin-top: 10px; 
            flex-wrap: wrap; 
        }
        
        .theme-box { 
            padding: 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            border: 2px solid #ddd; 
            transition: all 0.2s ease; 
            min-width: 120px; 
            text-align: center; 
        }
        
        .theme-box:hover, .theme-box.active { 
            border-color: var(--accent-color); 
            transform: scale(1.05); 
        }
        
        .theme-box.light { 
            background-color: #f4f6f9; 
        }
        
        .theme-box.dark { 
            background-color: #2b2b2b; 
            color: white; 
        }
        
        .custom-color-picker { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            margin-top: 20px; 
        }
        
        .custom-color-picker input[type="color"] { 
            width: 50px; 
            height: 50px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
        }

        /* Shipping Label Styles */
        .shipping-label { 
            border: 2px solid #333; 
            padding: 20px; 
            background: #fff; 
            max-width: 800px; 
            margin: auto; 
            font-family: var(--font-secondary); 
        }
        
        .label-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            border-bottom: 2px solid #333; 
            padding-bottom: 15px; 
        }
        
        .label-header h3 { 
            font-size: 28px; 
            margin: 0; 
            font-family: var(--font-primary);
        }
        
        .label-section { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            padding: 15px 0; 
            border-bottom: 1px dashed #999; 
        }
        
        .label-footer { 
            padding-top: 15px; 
            text-align: center; 
        }
        
        @media print { 
            body * { 
                visibility: hidden; 
            } 
            .shipping-label, .shipping-label * { 
                visibility: visible; 
            } 
            .shipping-label { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                border: none; 
                margin: 0; 
                padding: 0; 
            } 
        }

        /* Toast Notification */
        #toast { 
            visibility: hidden; 
            min-width: 250px; 
            background-color: var(--primary-color); 
            color: #fff; 
            text-align: center; 
            border-radius: 5px; 
            padding: 16px; 
            position: fixed; 
            z-index: 1000; 
            right: 30px; 
            bottom: 30px; 
            font-size: 16px; 
        }
        
        #toast.show { 
            visibility: visible; 
            animation: toast-in 0.5s, toast-out 0.5s 2.5s; 
        }
        
        #toast.success { 
            background-color: var(--success-color); 
        }
        
        #toast.error { 
            background-color: var(--danger-color); 
        }
        
        @keyframes toast-in { 
            from { 
                bottom: -50px; 
                opacity: 0; 
            } 
            to { 
                bottom: 30px; 
                opacity: 1; 
            } 
        }
        
        @keyframes toast-out { 
            from { 
                bottom: 30px; 
                opacity: 1; 
            } 
            to { 
                bottom: -50px; 
                opacity: 0; 
            } 
        }

        /* Search Box */
        .search-box { 
            width: 100%; 
            max-width: 300px; 
        }

        @media (max-width: 768px) {
            .sidebar { 
                width: 100%; 
                height: auto; 
                position: relative; 
            }
            .main-content { 
                margin-left: 0; 
            }
            .dashboard-cards { 
                grid-template-columns: 1fr; 
            }
            .order-details-grid { 
                grid-template-columns: 1fr; 
            }
            .modal-content { 
                width: 95%; 
                padding: 20px; 
            }
            .stats-grid { 
                grid-template-columns: 1fr; 
            }
            .export-options { 
                flex-direction: column; 
            }
            .coupons-grid { 
                grid-template-columns: 1fr; 
            }
            .theme-options { 
                flex-direction: column; 
            }
        }
    </style>
</head>
<body>
    <div id="loginContainer" class="login-container">
        <div class="login-form">
            <h2><i class="fas fa-crown"></i> ELDAVILY Admin</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
                <div id="loginMessage" class="error-message"></div>
            </form>
        </div>
    </div>

    <div id="adminPanel" class="admin-panel">
        <div class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-crown"></i>
                <h2>ELDAVILY</h2>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" data-tab="statistics">
                    <i class="fas fa-chart-line"></i>
                    <span>Statistics</span>
                </div>
                <div class="menu-item" data-tab="orders">
                    <i class="fas fa-receipt"></i>
                    <span>Orders</span>
                </div>
                <div class="menu-item" data-tab="products">
                    <i class="fas fa-box-open"></i>
                    <span>Products</span>
                </div>
                <div class="menu-item" data-tab="stock">
                    <i class="fas fa-warehouse"></i>
                    <span>Stock Management</span>
                </div>
                <div class="menu-item" data-tab="coupons">
                    <i class="fas fa-tags"></i>
                    <span>Coupons</span>
                </div>
                <div class="menu-item" data-tab="messages">
                    <i class="fas fa-envelope"></i>
                    <span>Customer Messages</span>
                </div>
                <div class="menu-item" data-tab="content">
                    <i class="fas fa-edit"></i>
                    <span>Store Content</span>
                </div>
                <a href="photo.html" target="_blank" style="text-decoration: none; color: white;">
                    <div class="menu-item">
                        <i class="fas fa-image"></i>
                        <span>add picture</span>
                    </div>
                </a>
                <div class="menu-item" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="menu-item" data-tab="notifications">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="top-bar">
                <h1 id="pageTitle">Admin Dashboard</h1>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">AD</div>
                    <span id="userEmail"></span>
                    <button class="logout-btn" id="logoutBtn">Logout</button>
                </div>
            </div>
            
            <div id="dashboard" class="tab-content active">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Revenue</div>
                            <div class="card-icon bg-primary"><i class="fas fa-dollar-sign"></i></div>
                        </div>
                        <div class="card-value" id="totalRevenue">$0.00</div>
                        <div class="card-desc">From delivered orders</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Total Orders</div>
                            <div class="card-icon bg-success"><i class="fas fa-shopping-bag"></i></div>
                        </div>
                        <div class="card-value" id="totalOrders">0</div>
                        <div class="card-desc">All time orders</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Shipped Orders</div>
                            <div class="card-icon bg-info"><i class="fas fa-truck"></i></div>
                        </div>
                        <div class="card-value" id="shippedOrders">0</div>
                        <div class="card-desc">Successfully delivered</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Returned Orders</div>
                            <div class="card-icon bg-danger"><i class="fas fa-undo"></i></div>
                        </div>
                        <div class="card-value" id="returnedOrders">0</div>
                        <div class="card-desc">Customer returns</div>
                    </div>
                </div>
                
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Platform Analytics</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stats-card">
                            <h3><i class="fas fa-star"></i> Best Sellers</h3>
                            <div class="stats-list" id="bestSellersList">
                                <div class="loading">Loading...</div>
                            </div>
                        </div>
                        <div class="stats-card">
                            <h3><i class="fas fa-exclamation-triangle"></i> Low Stock Items</h3>
                            <div class="stats-list" id="lowStockList">
                                <div class="loading">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Recent Activity</div>
                    </div>
                    <div id="recentActivity" class="loading">Loading recent activity...</div>
                </div>
            </div>
            
            <div id="statistics" class="tab-content">
                <div class="date-filter">
                    <button class="active" data-range="7">Last 7 Days</button>
                    <button data-range="30">Last 30 Days</button>
                    <button data-range="90">Last 90 Days</button>
                    <button data-range="365">Last Year</button>
                </div>
                
                <div class="export-options">
                    <button class="export-btn pdf" id="exportStatsPdf"><i class="fas fa-file-pdf"></i> Export Statistics as PDF</button>
                    <button class="export-btn excel" id="exportStatsExcel"><i class="fas fa-file-excel"></i> Export Statistics as Excel</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stats-card">
                        <div class="stats-header">
                            <div class="stats-title">Revenue Overview</div>
                            <div class="stats-change positive" id="revenueStatsChange">+0%</div>
                        </div>
                        <div class="stats-value" id="revenueStatsValue">$0</div>
                        <div class="chart-container" id="revenueChart">
                            <div class="chart-bars" style="display: flex; align-items: flex-end; height: 100%; gap: 5px; padding: 10px 0;"></div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="stats-header">
                            <div class="stats-title">Orders Overview</div>
                            <div class="stats-change positive" id="ordersStatsChange">+0%</div>
                        </div>
                        <div class="stats-value" id="ordersStatsValue">0</div>
                        <div class="chart-container" id="ordersChart">
                            <div class="chart-bars" style="display: flex; align-items: flex-end; height: 100%; gap: 5px; padding: 10px 0;"></div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="stats-header">
                            <div class="stats-title">Top Products</div>
                        </div>
                        <div class="stats-list" id="topProductsList"></div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="stats-header">
                            <div class="stats-title">Order Status Distribution</div>
                        </div>
                        <div class="chart-container" id="statusChart">
                            <div class="pie-chart" style="width: 150px; height: 150px; border-radius: 50%; margin: 0 auto; background: conic-gradient(
                                var(--success-color) 0% 40%, 
                                var(--warning-color) 40% 65%, 
                                var(--info-color) 65% 85%, 
                                var(--danger-color) 85% 100%
                            );"></div>
                        </div>
                        <div class="stats-list" id="statusLegend"></div>
                    </div>
                </div>
            </div>
            
            <div id="orders" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Order Management</div>
                        <div class="header-actions">
                            <input type="text" id="orderSearch" class="form-control search-box" placeholder="Search by Order ID or Name...">
                            <div class="export-options">
                                <button class="export-btn excel" id="exportOrdersCsv"><i class="fas fa-file-csv"></i> Export to Excel</button>
                                <button class="export-btn pdf" id="exportOrdersPdf"><i class="fas fa-file-pdf"></i> Export to PDF</button>
                            </div>
                        </div>
                    </div>
                    <div id="ordersListContainer">
                        </div>
                </div>
            </div>
            
            <div id="products" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Product Management</div>
                        <div class="section-actions">
                            <button id="addNewProductBtn">Add New Product</button>
                            <div class="export-options">
                                <button class="export-btn pdf" id="exportProductsPdf"><i class="fas fa-file-pdf"></i> Export as PDF</button>
                                <button class="export-btn excel" id="exportProductsExcel"><i class="fas fa-file-excel"></i> Export as Excel</button>
                            </div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="productsTable">
                            <thead>
                                <tr>
                                    <th>Product Name</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="productsList">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div id="stock" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Stock Management</div>
                        <div class="export-options">
                            <button class="export-btn pdf" id="exportStockPdf"><i class="fas fa-file-pdf"></i> Export as PDF</button>
                            <button class="export-btn excel" id="exportStockExcel"><i class="fas fa-file-excel"></i> Export as Excel</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="stockTable">
                            <thead>
                                <tr>
                                    <th>Product Name</th>
                                    <th>Current Stock</th>
                                    <th>Low Stock Alert</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="stockList">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="coupons" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Coupon Management</div>
                    </div>
                    <h3>Add New Coupon</h3>
                    <form id="couponForm" style="display: flex; gap: 15px; align-items: flex-end; margin-bottom: 30px;">
                        <div class="form-group" style="flex-grow: 1;">
                            <label>Coupon Code</label>
                            <input type="text" id="couponCode" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Discount (%)</label>
                            <input type="number" id="couponDiscount" class="form-control" min="1" max="100" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Coupon</button>
                    </form>
                    
                    <h3>Active Coupons</h3>
                    <div class="coupons-grid" id="couponsList"></div>
                </div>
            </div>

            <div id="messages" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Customer Messages</div>
                        <div class="export-options">
                            <button class="export-btn pdf" id="exportMessagesPdf"><i class="fas fa-file-pdf"></i> Export as PDF</button>
                            <button class="export-btn excel" id="exportMessagesExcel"><i class="fas fa-file-excel"></i> Export as Excel</button>
                        </div>
                    </div>
                    <div id="customerMessagesList"></div>
                </div>
            </div>
            
            <div id="content" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Hero Section Content</div>
                    </div>
                    <div class="form-group">
                        <label for="heroTitle">Hero Title</label>
                        <input type="text" id="heroTitle" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="heroSubtitle">Hero Subtitle</label>
                        <textarea id="heroSubtitle" class="form-control"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="heroButtonText">Button Text</label>
                        <input type="text" id="heroButtonText" class="form-control">
                    </div>
                    <button id="saveHeroBtn" class="btn btn-primary">Save Hero Content</button>
                </div>
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Background Control</div>
                    </div>
                    <div class="form-group">
                        <label for="bgType">Background Type</label>
                        <select id="bgType" class="form-control">
                            <option value="image">Image</option>
                            <option value="color">Solid Color</option>
                            <option value="gradient">Gradient</option>
                        </select>
                    </div>
                    <div id="bgImageOptions">
                        <div class="form-group">
                            <label for="bgImageUrl">Background Image URL</label>
                            <input type="text" id="bgImageUrl" class="form-control">
                        </div>
                    </div>
                    <div id="bgColorOptions" style="display:none;">
                        <div class="form-group">
                            <label for="bgColor">Background Color</label>
                            <input type="color" id="bgColor" class="form-control" value="#ffffff">
                        </div>
                    </div>
                    <div id="bgGradientOptions" style="display:none;">
                        <div class="form-group">
                            <label for="gradientColors">Gradient Colors (comma separated)</label>
                            <input type="text" id="gradientColors" class="form-control">
                        </div>
                    </div>
                    <button id="saveBgBtn" class="btn btn-primary">Save Background Settings</button>
                </div>
            </div>
            
            <div id="settings" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Theme & Background</div>
                    </div>
                    <p>Customize the look of your admin panel's main content area.</p>
                    <div class="theme-options">
                        <div class="theme-box light active" data-theme="light">Light (Default)</div>
                        <div class="theme-box dark" data-theme="dark">Dark</div>
                        <div class="custom-color-picker">
                            <input type="color" id="customColorPicker" value="#f4f6f9">
                            <label for="customColorPicker">Custom Color</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="notifications" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Send Customer Notifications</div>
                    </div>
                    <div class="form-group">
                        <label for="notificationTitle">Notification Title</label>
                        <input type="text" id="notificationTitle" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="notificationMessage">Notification Message</label>
                        <textarea id="notificationMessage" class="form-control"></textarea>
                    </div>
                    <div style="display:flex; gap:20px;">
                        <div class="form-group" style="flex:1;">
                            <label for="notificationExpiry">Display Until (Optional)</label>
                            <input type="datetime-local" id="notificationExpiry" class="form-control">
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label for="notificationPosition">Position</label>
                            <select id="notificationPosition" class="form-control">
                                <option value="top">Top Bar</option>
                                <option value="bottom">Bottom Banner</option>
                            </select>
                        </div>
                    </div>
                    <button id="sendNotificationBtn" class="btn btn-success"><i class="fas fa-paper-plane"></i> Send Notification</button>
                </div>
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-title">Notification History</div>
                        <div class="export-options">
                            <button class="export-btn pdf" id="exportNotificationsPdf"><i class="fas fa-file-pdf"></i> Export as PDF</button>
                            <button class="export-btn excel" id="exportNotificationsExcel"><i class="fas fa-file-excel"></i> Export as Excel</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="notificationsTable">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Message</th>
                                    <th>Position</th>
                                    <th>Sent Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="notificationHistory"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="productModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close" id="productModalClose">&times;</span>
            <h3 id="productModalTitle" style="margin-bottom:20px;">Add New Product</h3>
            <form id="productForm">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label for="productName">Product Name</label>
                    <input type="text" id="productName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="productCapacity">Product Capacity</label>
                    <input type="text" id="productCapacity" class="form-control" placeholder="e.g., 100ml, 50g, etc.">
                </div>
                <div class="form-group">
                    <label for="productPrice">Price</label>
                    <input type="number" id="productPrice" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="productStock">Stock Quantity</label>
                    <input type="number" id="productStock" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="productLowStockAlert">Low Stock Alert</label>
                    <input type="number" id="productLowStockAlert" class="form-control" value="5">
                </div>
                <div class="form-group">
                    <label for="productImageUrl">Image URL</label>
                    <input type="text" id="productImageUrl" class="form-control">
                </div>
                <div class="form-group">
                    <label for="productDescription">Description</label>
                    <textarea id="productDescription" class="form-control"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Save Product</button>
            </form>
        </div>
    </div>
    
    <div id="orderModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close" id="orderModalClose">&times;</span>
            <h3 id="orderModalTitle" style="margin-bottom:20px;">Order Details</h3>
            <div id="orderDetailsContent"></div>
        </div>
    </div>
    
    <div id="stockModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close" id="stockModalClose">&times;</span>
            <h3 id="stockModalTitle" style="margin-bottom:20px;">Update Stock</h3>
            <form id="stockForm">
                <input type="hidden" id="stockProductId">
                <div class="form-group">
                    <label for="stockProductName">Product Name</label>
                    <input type="text" id="stockProductName" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="stockCurrent">Current Stock</label>
                    <input type="number" id="stockCurrent" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="stockAdjustment">Adjustment</label>
                    <input type="number" id="stockAdjustment" class="form-control" required>
                    <small>Positive number to add stock, negative to remove</small>
                </div>
                <div class="form-group">
                    <label for="stockReason">Reason for Adjustment</label>
                    <select id="stockReason" class="form-control">
                        <option value="restock">Restock</option>
                        <option value="sale">Sale</option>
                        <option value="damaged">Damaged</option>
                        <option value="return">Customer Return</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="stockNotes">Notes (Optional)</label>
                    <textarea id="stockNotes" class="form-control"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Update Stock</button>
            </form>
        </div>
    </div>

    <div id="shipmentModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close" id="shipmentModalClose">&times;</span>
            <h3 id="shipmentModalTitle" style="margin-bottom:20px;">Prepare Shipment & Generate Label</h3>
            <form id="shippingForm">
                <input type="hidden" id="shippingOrderId">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                    <div>
                        <h4><i class="fas fa-paper-plane"></i> From (Sender)</h4>
                        <div class="form-group">
                            <label>Business Name</label>
                            <input type="text" id="senderName" class="form-control" value="ELDAVILY Perfumery" required>
                        </div>
                        <div class="form-group">
                            <label>Address</label>
                            <input type="text" id="senderAddress" class="form-control" placeholder="Your business address" required>
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="text" id="senderPhone" class="form-control" placeholder="Your business phone" required>
                        </div>
                    </div>
                    <div>
                         <h4><i class="fas fa-user-check"></i> To (Recipient)</h4>
                         <div class="form-group">
                            <label>Customer Name</label>
                            <input type="text" id="recipientName" class="form-control" required>
                         </div>
                         <div class="form-group">
                            <label>Address</label>
                            <input type="text" id="recipientAddress" class="form-control" required>
                         </div>
                         <div class="form-group">
                            <label>Phone</label>
                            <input type="text" id="recipientPhone" class="form-control" required>
                         </div>
                    </div>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-cogs"></i> Generate Label</button>
                </div>
            </form>
            <div id="label-preview-container" style="margin-top: 20px;"></div>
        </div>
    </div>

    <div id="messageModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close" id="messageModalClose">&times;</span>
            <h3 id="messageModalTitle" style="margin-bottom:20px;">Message Details</h3>
            <div id="messageDetailsContent"></div>
        </div>
    </div>

    <div id="toast"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDuaP43jD8LWw5A8cIbcgS7-bqCZTXzEEg",
            authDomain: "davily-feded.firebaseapp.com",
            databaseURL: "https://davily-feded-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "davily-feded",
            storageBucket: "davily-feded.appspot.com",
            messagingSenderId: "83255410493",
            appId: "1:83255410493:web:927c5e859c5b20805c4f54",
            measurementId: "G-LD4XHS6FGM"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Global variables
        let currentDateRange = 7;
        let ordersData = {};
        let productsData = {};
        let stockHistoryData = {};
        let contactMessagesData = {};
        let couponsData = {};
        let settingsData = { theme: 'light' };
        let senderInfoData = {};

        // UI Helpers
        const showToast = (message, type = 'success') => {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `show ${type}`;
            setTimeout(() => { toast.className = toast.className.replace('show', ''); }, 3000);
        };

        const openModal = (id) => document.getElementById(id).style.display = 'flex';
        const closeModal = (id) => document.getElementById(id).style.display = 'none';

        // Authentication
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('userAvatar').textContent = user.email.charAt(0).toUpperCase();
                initializeAdminPanel();
            } else {
                document.getElementById('loginContainer').style.display = 'flex';
                document.getElementById('adminPanel').style.display = 'none';
            }
        });

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .catch((error) => {
                    document.getElementById('loginMessage').textContent = error.message;
                });
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            auth.signOut();
        });

        function initializeAdminPanel() {
            setupTabs();
            setupEventListeners();
            loadAllData();
            setupOrderListener();
            loadSettings();
        }

        function setupTabs() {
            document.querySelectorAll('.menu-item').forEach(item => {
                // Check if the item has a data-tab attribute before adding the listener
                if (item.dataset.tab) {
                    item.addEventListener('click', () => {
                        const tabId = item.dataset.tab;
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        document.getElementById(tabId).classList.add('active');
                        document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        document.getElementById('pageTitle').textContent = item.querySelector('span').textContent;
                        
                        if (tabId === 'statistics') {
                            loadStatistics(currentDateRange);
                        }
                    });
                }
            });
            
            document.querySelectorAll('.date-filter button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.date-filter button').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    currentDateRange = parseInt(this.dataset.range);
                    loadStatistics(currentDateRange);
                });
            });
        }

        function setupEventListeners() {
            // Hero content
            document.getElementById('saveHeroBtn').addEventListener('click', () => {
                const heroData = {
                    title: document.getElementById('heroTitle').value,
                    subtitle: document.getElementById('heroSubtitle').value,
                    buttonText: document.getElementById('heroButtonText').value
                };
                database.ref('admin/heroContent').set(heroData)
                    .then(() => showToast('Hero content saved successfully'))
                    .catch(error => showToast('Error saving hero content: ' + error.message, 'error'));
            });

            // Background settings
            document.getElementById('saveBgBtn').addEventListener('click', () => {
                const bgData = {
                    type: document.getElementById('bgType').value,
                    imageUrl: document.getElementById('bgImageUrl').value,
                    color: document.getElementById('bgColor').value,
                    gradientColors: document.getElementById('gradientColors').value
                };
                database.ref('admin/background').set(bgData)
                    .then(() => showToast('Background settings saved successfully'))
                    .catch(error => showToast('Error saving background settings: ' + error.message, 'error'));
            });

            document.getElementById('bgType').addEventListener('change', () => {
                const type = document.getElementById('bgType').value;
                document.getElementById('bgImageOptions').style.display = type === 'image' ? 'block' : 'none';
                document.getElementById('bgColorOptions').style.display = type === 'color' ? 'block' : 'none';
                document.getElementById('bgGradientOptions').style.display = type === 'gradient' ? 'block' : 'none';
            });

            // Notifications
            document.getElementById('sendNotificationBtn').addEventListener('click', sendNotification);
            
            // Products
            document.getElementById('addNewProductBtn').addEventListener('click', () => openProductModal());
            document.getElementById('productModalClose').addEventListener('click', () => closeModal('productModal'));
            document.getElementById('productForm').addEventListener('submit', saveProduct);
            
            // Orders
            document.getElementById('orderModalClose').addEventListener('click', () => closeModal('orderModal'));
            
            // Stock
            document.getElementById('stockModalClose').addEventListener('click', () => closeModal('stockModal'));
            document.getElementById('stockForm').addEventListener('submit', updateStock);
            
            // Messages
            document.getElementById('messageModalClose').addEventListener('click', () => closeModal('messageModal'));
            
            // Shipment
            document.getElementById('shipmentModalClose').addEventListener('click', () => closeModal('shipmentModal'));
            
            // Coupons
            document.getElementById('couponForm').addEventListener('submit', addCoupon);
            
            // Theme settings
            document.querySelectorAll('.theme-box').forEach(box => {
                box.addEventListener('click', () => applyTheme(box.dataset.theme));
            });
            document.getElementById('customColorPicker').addEventListener('input', (e) => applyTheme(e.target.value));
            
            // Shipping form
            document.getElementById('shippingForm').addEventListener('submit', generateShippingLabel);
            
            // Export buttons
            setupExportButtons();
            
            // Search functionality
            document.getElementById('orderSearch').addEventListener('keyup', (e) => renderOrders(e.target.value));
        }

        function setupExportButtons() {
            // Orders export
            document.getElementById('exportOrdersCsv').addEventListener('click', exportOrdersToCsv);
            document.getElementById('exportOrdersPdf').addEventListener('click', exportOrdersToPdf);
            
            // Products export
            document.getElementById('exportProductsPdf').addEventListener('click', exportProductsToPdf);
            document.getElementById('exportProductsExcel').addEventListener('click', exportProductsToExcel);
            
            // Stock export
            document.getElementById('exportStockPdf').addEventListener('click', exportStockToPdf);
            document.getElementById('exportStockExcel').addEventListener('click', exportStockToExcel);
            
            // Messages export
            document.getElementById('exportMessagesPdf').addEventListener('click', exportMessagesToPdf);
            document.getElementById('exportMessagesExcel').addEventListener('click', exportMessagesToExcel);
            
            // Notifications export
            document.getElementById('exportNotificationsPdf').addEventListener('click', exportNotificationsToPdf);
            document.getElementById('exportNotificationsExcel').addEventListener('click', exportNotificationsToExcel);
        }

        // Order Status Management
        window.updateOrderStatus = (orderId, newStatus) => {
            if (!ordersData[orderId]) return;
            
            const currentStatus = ordersData[orderId].status;
            
            database.ref(`orders/${orderId}`).update({ status: newStatus })
                .then(() => {
                    showToast(`Order ${orderId} status updated from ${currentStatus} to ${newStatus}`);
                    ordersData[orderId].status = newStatus;
                    renderOrders();
                    renderDashboard();
                })
                .catch(error => {
                    showToast('Error updating order status: ' + error.message, 'error');
                });
        };

        // Enhanced Order Rendering
        function renderOrders(searchTerm = '') {
            const container = document.getElementById('ordersListContainer');
            if (!container) return;
            
            const filteredOrders = Object.entries(ordersData).filter(([id, order]) => {
                const searchLower = searchTerm.toLowerCase();
                return id.toLowerCase().includes(searchLower) || 
                       (order.customer?.name || '').toLowerCase().includes(searchLower);
            });
            
            container.innerHTML = '';
            
            if (filteredOrders.length === 0) {
                container.innerHTML = '<div class="card"><p>No orders found.</p></div>';
                return;
            }
            
            // Sort by date (newest first)
            filteredOrders.sort(([,a], [,b]) => {
                const dateA = new Date(a.createdAt || a.timestamp || 0);
                const dateB = new Date(b.createdAt || b.timestamp || 0);
                return dateB - dateA;
            });
            
            filteredOrders.forEach(([id, order]) => {
                const statuses = ['pending', 'confirmed', 'shipped', 'delivered', 'cancelled', 'returned'];
                const statusOptions = statuses.map(s => 
                    `<option value="${s}" ${order.status === s ? 'selected' : ''}>${s.charAt(0).toUpperCase() + s.slice(1)}</option>`
                ).join('');
                
                let action = '';
                if (order.status === 'pending') {
                    action = `<button class="btn btn-primary btn-sm" onclick="openShipmentModal('${id}')"><i class="fas fa-box-open"></i> Confirm Shipment</button>`;
                } else {
                    action = `<select class="form-control" style="padding: 8px; width: auto;" onchange="updateOrderStatus('${id}', this.value)">${statusOptions}</select>`;
                }
                
                const orderCard = document.createElement('div');
                orderCard.className = 'card order-card';
                orderCard.innerHTML = `
                    <div class="order-header">
                        <div><strong>Order ID:</strong> ${id.substring(0, 8)}</div>
                        <div><strong>Date:</strong> ${new Date(order.createdAt || order.timestamp || Date.now()).toLocaleDateString()}</div>
                    </div>
                    <div class="order-details">
                        <p><strong>Customer:</strong> ${order.customer?.name || 'Unknown Customer'}</p>
                        <p><strong>Total:</strong> $${(order.total || 0).toFixed(2)}</p>
                        <div><strong>Status:</strong> <span class="status-badge status-${order.status}">${order.status.charAt(0).toUpperCase() + order.status.slice(1)}</span></div>
                    </div>
                    <div class="order-actions">
                        ${action}
                        <button class="btn btn-primary btn-sm" onclick="viewOrderDetails('${id}')"><i class="fas fa-eye"></i> View</button>
                    </div>
                `;
                
                container.appendChild(orderCard);
            });
        }

        // Enhanced Dashboard Calculations
        function renderDashboard() {
            if (!ordersData) return;
            
            const deliveredOrders = Object.values(ordersData).filter(o => o.status === 'delivered');
            const shippedOrders = Object.values(ordersData).filter(o => o.status === 'shipped');
            const returnedOrders = Object.values(ordersData).filter(o => o.status === 'returned');
            
            const totalRevenue = deliveredOrders.reduce((sum, order) => sum + (order.total || 0), 0);
            const totalOrders = Object.keys(ordersData).length;
            
            document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('shippedOrders').textContent = shippedOrders.length;
            document.getElementById('returnedOrders').textContent = returnedOrders.length;
            
            // Calculate best sellers
            const itemCounts = deliveredOrders.flatMap(o => o.items || []).reduce((acc, item) => {
                const productName = item.name || 'Unknown Product';
                acc[productName] = (acc[productName] || 0) + (item.quantity || 1);
                return acc;
            }, {});
            
            const sortedItems = Object.entries(itemCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const bestSellersList = document.getElementById('bestSellersList');
            if (bestSellersList) {
                bestSellersList.innerHTML = sortedItems.length ? 
                    sortedItems.map(([name, count]) => `<div class="stats-list-item"><span>${name}</span><span>${count} sold</span></div>`).join('') : 
                    '<p>No sales data available.</p>';
            }
            
            // Calculate low stock items
            const lowStockItems = Object.values(productsData)
                .filter(p => p.stock > 0 && p.stock <= (p.lowStockAlert || 5))
                .slice(0, 5);
            
            const lowStockList = document.getElementById('lowStockList');
            if (lowStockList) {
                lowStockList.innerHTML = lowStockItems.length ? 
                    lowStockItems.map(p => `<div class="stats-list-item"><span>${p.name}</span><span class="stock-low">${p.stock} left</span></div>`).join('') : 
                    '<p>All items well-stocked.</p>';
            }
        }

        function loadAllData() {
            // Load products
            database.ref('products').on('value', snapshot => {
                productsData = snapshot.val() || {};
                renderProducts();
                renderDashboard();
                updateStockManagement();
            });
            
            // Load orders
            database.ref('orders').on('value', snapshot => {
                ordersData = snapshot.val() || {};
                renderOrders();
                renderDashboard();
                loadRecentActivity();
            });
            
            // Load customer messages
            database.ref('contactMessages').on('value', snapshot => {
                contactMessagesData = snapshot.val() || {};
                renderMessages();
            });
            
            // Load coupons
            database.ref('coupons').on('value', snapshot => {
                couponsData = snapshot.val() || {};
                renderCoupons();
            });
            
            // Load notifications
            database.ref('notifications').on('value', snapshot => {
                renderNotifications(snapshot.val() || {});
            });
            
            // Load stock history
            database.ref('stockHistory').on('value', snapshot => {
                stockHistoryData = snapshot.val() || {};
            });
            
            // Load sender info
            database.ref('admin/senderInfo').on('value', snapshot => {
                senderInfoData = snapshot.val() || {};
                if (senderInfoData.name) {
                    document.getElementById('senderName').value = senderInfoData.name;
                }
                if (senderInfoData.address) {
                    document.getElementById('senderAddress').value = senderInfoData.address;
                }
                if (senderInfoData.phone) {
                    document.getElementById('senderPhone').value = senderInfoData.phone;
                }
            });
            
            // Load hero content
            database.ref('admin/heroContent').on('value', snapshot => {
                const heroData = snapshot.val();
                if (heroData) {
                    document.getElementById('heroTitle').value = heroData.title || '';
                    document.getElementById('heroSubtitle').value = heroData.subtitle || '';
                    document.getElementById('heroButtonText').value = heroData.buttonText || '';
                }
            });
            
            // Load background settings
            database.ref('admin/background').on('value', snapshot => {
                const bgData = snapshot.val();
                if (bgData) {
                    document.getElementById('bgType').value = bgData.type || 'image';
                    document.getElementById('bgImageUrl').value = bgData.imageUrl || '';
                    document.getElementById('bgColor').value = bgData.color || '#ffffff';
                    document.getElementById('gradientColors').value = bgData.gradientColors || '';
                    document.getElementById('bgType').dispatchEvent(new Event('change'));
                }
            });
        }

        function setupOrderListener() {
            database.ref('orders').on('value', snapshot => {
                const orders = snapshot.val() || {};
                Object.entries(orders).forEach(([orderId, order]) => {
                    if (!order.stockProcessed && order.status === 'confirmed') {
                        processOrderStock(orderId, order);
                    }
                });
            });
        }

        function processOrderStock(orderId, order) {
            if (!order.items || !Array.isArray(order.items)) return;

            let allItemsProcessed = true;
            const stockUpdates = {};

            order.items.forEach(item => {
                const productId = item.productId;
                const quantity = item.quantity || 1;
                
                if (productId && productsData[productId]) {
                    const currentStock = productsData[productId].stock || 0;
                    
                    if (currentStock >= quantity) {
                        const newStock = currentStock - quantity;
                        stockUpdates[productId] = newStock;
                        
                        const stockHistory = {
                            productId: productId,
                            productName: productsData[productId].name,
                            previousStock: currentStock,
                            newStock: newStock,
                            adjustment: -quantity,
                            reason: 'order_placement',
                            orderId: orderId,
                            timestamp: firebase.database.ServerValue.TIMESTAMP,
                            updatedBy: 'system'
                        };
                        database.ref('stockHistory').push(stockHistory);
                        
                        updateProductStatus(productId, newStock, productsData[productId].lowStockAlert);
                    } else {
                        allItemsProcessed = false;
                    }
                } else {
                    allItemsProcessed = false;
                }
            });

            if (Object.keys(stockUpdates).length > 0) {
                Object.keys(stockUpdates).forEach(productId => {
                    database.ref(`products/${productId}/stock`).set(stockUpdates[productId]);
                });
            }

            if (allItemsProcessed) {
                database.ref(`orders/${orderId}/stockProcessed`).set(true);
            }
        }

        function updateProductStatus(productId, newStock, lowStockAlert = 5) {
            let status = 'active';
            if (newStock <= 0) {
                status = 'out_of_stock';
            } else if (newStock <= lowStockAlert) {
                status = 'low_stock';
            }
            
            database.ref(`products/${productId}/status`).set(status);
        }

        function loadSettings() {
            database.ref('admin/settings').on('value', snapshot => {
                if (snapshot.val()) {
                    settingsData = snapshot.val();
                    applyTheme(settingsData.theme);
                    if (settingsData.theme.startsWith('#')) {
                        document.getElementById('customColorPicker').value = settingsData.theme;
                    }
                }
            });
        }

        function applyTheme(themeValue) {
            const mainContent = document.querySelector('.main-content');
            document.querySelectorAll('.theme-box').forEach(box => box.classList.remove('active'));
            
            if (themeValue === 'light') {
                mainContent.style.backgroundColor = '#f5f7fa';
                document.querySelector('.theme-box.light').classList.add('active');
            } else if (themeValue === 'dark') {
                mainContent.style.backgroundColor = '#2b2b2b';
                document.querySelector('.theme-box.dark').classList.add('active');
            } else {
                mainContent.style.backgroundColor = themeValue;
            }
            
            settingsData.theme = themeValue;
            database.ref('admin/settings').set(settingsData);
        }

        // Coupon Management
        function addCoupon(e) {
            e.preventDefault();
            const code = document.getElementById('couponCode').value.toUpperCase();
            const discount = parseInt(document.getElementById('couponDiscount').value);
            
            if (code && discount) {
                couponsData[code] = discount;
                database.ref('coupons').set(couponsData)
                    .then(() => {
                        showToast(`Coupon ${code} added.`);
                        document.getElementById('couponForm').reset();
                    })
                    .catch(error => {
                        showToast('Error adding coupon: ' + error.message, 'error');
                    });
            }
        }

        function renderCoupons() {
            const couponsList = document.getElementById('couponsList');
            couponsList.innerHTML = '';
            
            for (const code in couponsData) {
                couponsList.innerHTML += `
                    <div class="coupon-card">
                        <div class="coupon-code">${code}</div>
                        <div class="coupon-discount">${couponsData[code]}% OFF</div>
                        <div class="coupon-actions">
                            <button onclick="deleteCoupon('${code}')" class="btn btn-sm" style="background-color:var(--danger-color);"><i class="fas fa-trash"></i> Delete</button>
                        </div>
                    </div>
                `;
            }
            
            if (Object.keys(couponsData).length === 0) {
                couponsList.innerHTML = '<p>No active coupons.</p>';
            }
        }

        window.deleteCoupon = (code) => {
            if (confirm(`Are you sure you want to delete the coupon ${code}?`)) {
                delete couponsData[code];
                database.ref('coupons').set(couponsData)
                    .then(() => {
                        showToast(`Coupon ${code} deleted.`, 'error');
                    })
                    .catch(error => {
                        showToast('Error deleting coupon: ' + error.message, 'error');
                    });
            }
        };

        // Shipping Management
        window.openShipmentModal = (orderId) => {
            const order = ordersData[orderId];
            if (!order) return;
            
            document.getElementById('shippingOrderId').value = orderId;
            document.getElementById('recipientName').value = order.customer?.name || '';
            document.getElementById('recipientAddress').value = order.customer?.address || '';
            document.getElementById('recipientPhone').value = order.customer?.phone || '';
            document.getElementById('label-preview-container').innerHTML = '';
            
            openModal('shipmentModal');
        };

        function generateShippingLabel(e) {
            e.preventDefault();
            const orderId = document.getElementById('shippingOrderId').value;
            const order = ordersData[orderId];
            const sender = {
                name: document.getElementById('senderName').value,
                address: document.getElementById('senderAddress').value,
                phone: document.getElementById('senderPhone').value
            };
            const recipient = {
                name: document.getElementById('recipientName').value,
                address: document.getElementById('recipientAddress').value,
                phone: document.getElementById('recipientPhone').value
            };
            
            // Save sender info
            database.ref('admin/senderInfo').set(sender);
            
            document.getElementById('label-preview-container').innerHTML = `
                <div class="shipping-label" id="printableLabel">
                    <div class="label-header">
                        <h3>ELDAVILY</h3>
                        <div>
                            <b>Order ID:</b> ${orderId.substring(0, 8)}<br>
                            <b>Date:</b> ${new Date().toLocaleDateString()}
                        </div>
                    </div>
                    <div class="label-section">
                        <div>
                            <h4>From:</h4>
                            <p>${sender.name}<br>${sender.address}<br>Tel: ${sender.phone}</p>
                        </div>
                        <div>
                            <h4>To:</h4>
                            <p><b>${recipient.name}</b><br>${recipient.address}<br>Tel: ${recipient.phone}</p>
                        </div>
                    </div>
                    <div style="padding: 15px 0;"><b>Contents:</b> Luxury Perfumery Items</div>
                    <div class="label-footer">
                        <svg id="barcode"></svg>
                    </div>
                </div>
                <div style="text-align:center; margin-top:20px;">
                    <button class="btn btn-primary" onclick="window.print()"><i class="fas fa-print"></i> Print Label</button>
                </div>
            `;
            
            // Generate barcode
            if (typeof JsBarcode !== 'undefined') {
                JsBarcode("#barcode", orderId, { format: "CODE128", displayValue: true, fontSize: 16 });
            }
            
            // Update order status to confirmed
            database.ref(`orders/${orderId}/status`).set('confirmed');
            
            showToast('Shipping label generated successfully');
        }

        // Product Management
        function renderProducts() {
            const productsList = document.getElementById('productsList');
            if (!productsList) return;
            
            productsList.innerHTML = '';
            
            Object.keys(productsData).forEach(key => {
                const p = productsData[key];
                const stockStatus = getStockStatus(p.stock, p.lowStockAlert);
                const statusBadge = getStatusBadge(p.status);
                
                productsList.innerHTML += `
                    <tr>
                        <td>
                            <div><strong>${p.name}</strong></div>
                            <small style="color:#666;">${p.capacity || 'No capacity specified'}</small>
                        </td>
                        <td>$${Number(p.price).toFixed(2)}</td>
                        <td class="stock-info ${stockStatus.class}">
                            <span>${p.stock || 0}</span>
                            ${p.stock <= (p.lowStockAlert || 5) ? '<i class="fas fa-exclamation-triangle"></i>' : ''}
                        </td>
                        <td>${statusBadge}</td>
                        <td>
                            <button onclick="editProduct('${key}')" class="btn btn-sm btn-primary"><i class="fas fa-edit"></i></button>
                            <button onclick="updateStockModal('${key}')" class="btn btn-sm" style="background-color:var(--info-color); margin-left:5px;"><i class="fas fa-boxes"></i></button>
                            <button onclick="deleteProduct('${key}')" class="btn btn-sm" style="background-color:var(--danger-color); margin-left:5px;"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
        }

        function openProductModal(id = null) {
            const form = document.getElementById('productForm');
            form.reset();
            document.getElementById('productId').value = id || '';
            document.getElementById('productModalTitle').textContent = id ? 'Edit Product' : 'Add New Product';
            
            if (id) {
                database.ref(`products/${id}`).once('value', snapshot => {
                    const p = snapshot.val();
                    if (p) {
                        document.getElementById('productName').value = p.name || '';
                        document.getElementById('productCapacity').value = p.capacity || '';
                        document.getElementById('productPrice').value = p.price || '';
                        document.getElementById('productStock').value = p.stock || 0;
                        document.getElementById('productLowStockAlert').value = p.lowStockAlert || 5;
                        document.getElementById('productImageUrl').value = p.imageUrl || '';
                        document.getElementById('productDescription').value = p.description || '';
                    }
                });
            }
            
            openModal('productModal');
        }

        function saveProduct(e) {
            e.preventDefault();
            const id = document.getElementById('productId').value;
            const stock = parseInt(document.getElementById('productStock').value);
            const lowStockAlert = parseInt(document.getElementById('productLowStockAlert').value);
            
            const data = {
                name: document.getElementById('productName').value,
                capacity: document.getElementById('productCapacity').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: stock,
                lowStockAlert: lowStockAlert,
                imageUrl: document.getElementById('productImageUrl').value,
                description: document.getElementById('productDescription').value
            };
            
            // Automatically set status based on stock
            if (stock <= 0) {
                data.status = 'out_of_stock';
            } else if (stock <= lowStockAlert) {
                data.status = 'low_stock';
            } else {
                data.status = 'active';
            }
            
            const productRef = id ? database.ref(`products/${id}`) : database.ref('products').push();
            
            productRef.set(data)
                .then(() => {
                    closeModal('productModal');
                    showToast('Product saved successfully!');
                    
                    // Record stock history if this is a new product or stock changed
                    if (!id || (id && productsData[id] && productsData[id].stock !== data.stock)) {
                        const stockHistory = {
                            productId: id || productRef.key,
                            productName: data.name,
                            previousStock: id ? (productsData[id]?.stock || 0) : 0,
                            newStock: data.stock,
                            adjustment: id ? (data.stock - (productsData[id]?.stock || 0)) : data.stock,
                            reason: id ? 'product_edit' : 'new_product',
                            timestamp: firebase.database.ServerValue.TIMESTAMP,
                            updatedBy: auth.currentUser.email
                        };
                        database.ref('stockHistory').push(stockHistory);
                    }
                })
                .catch(error => {
                    showToast('Error saving product: ' + error.message, 'error');
                });
        }

        window.editProduct = (id) => openProductModal(id);

        window.deleteProduct = (id) => {
            if (confirm('Delete this product?')) {
                database.ref(`products/${id}`).remove()
                    .then(() => showToast('Product deleted successfully'))
                    .catch(error => showToast('Error deleting product: ' + error.message, 'error'));
            }
        };

        // Stock Management
        function updateStockManagement() {
            const stockList = document.getElementById('stockList');
            if (!stockList) return;
            
            stockList.innerHTML = '';
            
            Object.keys(productsData).forEach(key => {
                const p = productsData[key];
                const stockStatus = getStockStatus(p.stock, p.lowStockAlert);
                const statusBadge = getStatusBadge(p.status);
                
                stockList.innerHTML += `
                    <tr>
                        <td>
                            <div><strong>${p.name}</strong></div>
                            <small style="color:#666;">${p.capacity || 'No capacity specified'}</small>
                        </td>
                        <td class="stock-info ${stockStatus.class}">
                            <span>${p.stock || 0}</span>
                            ${p.stock <= (p.lowStockAlert || 5) ? '<i class="fas fa-exclamation-triangle"></i>' : ''}
                        </td>
                        <td>${p.lowStockAlert || 5}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button onclick="updateStockModal('${key}')" class="btn btn-sm" style="background-color:var(--info-color);"><i class="fas fa-edit"></i> Update</button>
                            <button onclick="viewStockHistory('${key}')" class="btn btn-sm btn-primary" style="margin-left:5px;"><i class="fas fa-history"></i> History</button>
                        </td>
                    </tr>
                `;
            });
        }

        window.updateStockModal = (id) => {
            if (!productsData[id]) return;
            
            const product = productsData[id];
            document.getElementById('stockProductId').value = id;
            document.getElementById('stockProductName').value = product.name;
            document.getElementById('stockCurrent').value = product.stock || 0;
            document.getElementById('stockAdjustment').value = '';
            document.getElementById('stockReason').value = 'restock';
            document.getElementById('stockNotes').value = '';
            
            openModal('stockModal');
        };

        function updateStock(e) {
            e.preventDefault();
            const productId = document.getElementById('stockProductId').value;
            const adjustment = parseInt(document.getElementById('stockAdjustment').value);
            const reason = document.getElementById('stockReason').value;
            const notes = document.getElementById('stockNotes').value;
            
            if (!productId || isNaN(adjustment)) {
                alert('Please enter a valid adjustment value');
                return;
            }
            
            const currentStock = parseInt(document.getElementById('stockCurrent').value);
            const newStock = currentStock + adjustment;
            
            if (newStock < 0) {
                alert('Stock cannot be negative');
                return;
            }
            
            const lowStockAlert = productsData[productId].lowStockAlert || 5;
            let status = 'active';
            
            if (newStock <= 0) {
                status = 'out_of_stock';
            } else if (newStock <= lowStockAlert) {
                status = 'low_stock';
            }
            
            const updates = {
                stock: newStock,
                status: status
            };
            
            database.ref(`products/${productId}`).update(updates)
                .then(() => {
                    // Record stock history
                    const stockHistory = {
                        productId: productId,
                        productName: productsData[productId].name,
                        previousStock: currentStock,
                        newStock: newStock,
                        adjustment: adjustment,
                        reason: reason,
                        notes: notes,
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        updatedBy: auth.currentUser.email
                    };
                    
                    return database.ref('stockHistory').push(stockHistory);
                })
                .then(() => {
                    closeModal('stockModal');
                    showToast('Stock updated successfully');
                })
                .catch(error => {
                    showToast('Error updating stock: ' + error.message, 'error');
                });
        }

        window.viewStockHistory = (productId) => {
            if (!productId) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.style.display = 'flex';
            
            let historyHtml = '<h3>Stock History for ' + (productsData[productId]?.name || 'Unknown Product') + '</h3>';
            historyHtml += '<table class="data-table"><thead><tr><th>Date</th><th>Previous</th><th>Adjustment</th><th>New Stock</th><th>Reason</th><th>Updated By</th></tr></thead><tbody>';
            
            if (stockHistoryData) {
                Object.keys(stockHistoryData)
                    .filter(key => stockHistoryData[key].productId === productId)
                    .sort((a, b) => new Date(stockHistoryData[b].timestamp) - new Date(stockHistoryData[a].timestamp))
                    .forEach(key => {
                        const record = stockHistoryData[key];
                        historyHtml += `
                            <tr>
                                <td>${new Date(record.timestamp).toLocaleString()}</td>
                                <td>${record.previousStock}</td>
                                <td>${record.adjustment > 0 ? '+' : ''}${record.adjustment}</td>
                                <td>${record.newStock}</td>
                                <td>${record.reason}</td>
                                <td>${record.updatedBy || 'System'}</td>
                            </tr>
                        `;
                    });
            }
            
            historyHtml += '</tbody></table>';
            historyHtml += '<button onclick="this.parentElement.style.display=\'none\'" class="btn btn-primary" style="margin-top:20px;">Close</button>';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="modal-close" onclick="this.parentElement.parentElement.style.display='none'">&times;</span>
                    ${historyHtml}
                </div>
            `;
            
            document.body.appendChild(modal);
        };

        // Helper Functions
        function getStockStatus(stock, lowStockAlert = 5) {
            if (stock <= 0) {
                return { class: 'stock-out', text: 'Out of Stock' };
            } else if (stock <= lowStockAlert) {
                return { class: 'stock-low', text: 'Low Stock' };
            } else if (stock <= lowStockAlert * 2) {
                return { class: 'stock-medium', text: 'Medium Stock' };
            } else {
                return { class: 'stock-high', text: 'In Stock' };
            }
        }

        function getStatusBadge(status) {
            switch(status) {
                case 'active':
                    return '<span class="status-badge status-active">Active</span>';
                case 'out_of_stock':
                    return '<span class="status-badge status-expired">Out of Stock</span>';
                case 'low_stock':
                    return '<span class="status-badge status-pending">Low Stock</span>';
                default:
                    return '<span class="status-badge status-active">Active</span>';
            }
        }

        // Export Functions
        function exportOrdersToPdf() {
            if (Object.keys(ordersData).length === 0) {
                showToast("No orders to export.", "error");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            //  
            doc.setFontSize(20);
            doc.text('ELDAVILY - Orders Report', 14, 22);
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 30);
            
            //  
            const tableData = Object.entries(ordersData).map(([id, order]) => [
                id.substring(0, 8),
                order.customer?.name || 'Unknown',
                new Date(order.createdAt || order.timestamp || Date.now()).toLocaleDateString(),
                `$${(order.total || 0).toFixed(2)}`,
                order.status || 'pending'
            ]);

            doc.autoTable({
                head: [['Order ID', 'Customer', 'Date', 'Total', 'Status']],
                body: tableData,
                startY: 40,
                styles: { fontSize: 10 },
                headStyles: { fillColor: [201, 169, 109] }
            });

            doc.save('eldavily_orders.pdf');
            showToast('Orders exported successfully to PDF');
        }

        function exportOrdersToCsv() {
            if (Object.keys(ordersData).length === 0) {
                showToast("No orders to export.", "error");
                return;
            }
            
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Order ID,Customer,Date,Total,Status,Products\n"
                + Object.entries(ordersData).map(([id, order]) => {
                    const products = order.items ? order.items.map(item => 
                        `${item.name || 'Unknown'} (${item.quantity || 1})`
                    ).join('; ') : 'No items';
                    
                    return [
                        id.substring(0, 8),
                        `"${order.customer?.name || 'Unknown'}"`,
                        new Date(order.createdAt || order.timestamp || Date.now()).toLocaleDateString(),
                        order.total || 0,
                        order.status || 'pending',
                        `"${products}"`
                    ].join(',');
                }).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "eldavily_orders.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Orders exported successfully to CSV');
        }

        function exportProductsToPdf() {
            if (Object.keys(productsData).length === 0) {
                showToast("No products to export.", "error");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('ELDAVILY - Products Report', 14, 22);
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 30);
            
            const tableData = Object.entries(productsData).map(([id, product]) => [
                product.name || 'Unknown',
                product.capacity || 'N/A',
                `$${Number(product.price || 0).toFixed(2)}`,
                product.stock || 0,
                product.status || 'active'
            ]);

            doc.autoTable({
                head: [['Product Name', 'Capacity', 'Price', 'Stock', 'Status']],
                body: tableData,
                startY: 40,
                styles: { fontSize: 10 },
                headStyles: { fillColor: [201, 169, 109] }
            });

            doc.save('eldavily_products.pdf');
            showToast('Products exported successfully to PDF');
        }

        function exportProductsToExcel() {
            if (Object.keys(productsData).length === 0) {
                showToast("No products to export.", "error");
                return;
            }

            const data = Object.entries(productsData).map(([id, product]) => ({
                'Product Name': product.name || 'Unknown',
                'Capacity': product.capacity || 'N/A',
                'Price': `$${Number(product.price || 0).toFixed(2)}`,
                'Stock': product.stock || 0,
                'Low Stock Alert': product.lowStockAlert || 5,
                'Status': product.status || 'active',
                'Description': product.description || ''
            }));

            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Products");
            XLSX.writeFile(workbook, "eldavily_products.xlsx");
            
            showToast('Products exported successfully to Excel');
        }

        function exportStockToPdf() {
            if (Object.keys(productsData).length === 0) {
                showToast("No stock data to export.", "error");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('ELDAVILY - Stock Management Report', 14, 22);
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 30);
            
            const tableData = Object.entries(productsData).map(([id, product]) => [
                product.name || 'Unknown',
                product.capacity || 'N/A',
                product.stock || 0,
                product.lowStockAlert || 5,
                getStockStatus(product.stock, product.lowStockAlert).text
            ]);

            doc.autoTable({
                head: [['Product Name', 'Capacity', 'Current Stock', 'Low Stock Alert', 'Status']],
                body: tableData,
                startY: 40,
                styles: { fontSize: 10 },
                headStyles: { fillColor: [201, 169, 109] }
            });

            doc.save('eldavily_stock.pdf');
            showToast('Stock data exported successfully to PDF');
        }

        function exportStockToExcel() {
            if (Object.keys(productsData).length === 0) {
                showToast("No stock data to export.", "error");
                return;
            }

            const data = Object.entries(productsData).map(([id, product]) => ({
                'Product Name': product.name || 'Unknown',
                'Capacity': product.capacity || 'N/A',
                'Current Stock': product.stock || 0,
                'Low Stock Alert': product.lowStockAlert || 5,
                'Status': getStockStatus(product.stock, product.lowStockAlert).text
            }));

            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Stock");
            XLSX.writeFile(workbook, "eldavily_stock.xlsx");
            
            showToast('Stock data exported successfully to Excel');
        }

        function exportMessagesToPdf() {
            if (Object.keys(contactMessagesData).length === 0) {
                showToast("No messages to export.", "error");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('ELDAVILY - Customer Messages Report', 14, 22);
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 30);
            
            const tableData = Object.entries(contactMessagesData).map(([id, message]) => [
                message.name || 'Unknown',
                message.email || 'No email',
                message.phone || 'No phone',
                new Date(message.sentAt).toLocaleDateString(),
                message.read ? 'Read' : 'Unread'
            ]);

            doc.autoTable({
                head: [['Name', 'Email', 'Phone', 'Date', 'Status']],
                body: tableData,
                startY: 40,
                styles: { fontSize: 10 },
                headStyles: { fillColor: [201, 169, 109] }
            });

            doc.save('eldavily_messages.pdf');
            showToast('Messages exported successfully to PDF');
        }

        function exportMessagesToExcel() {
            if (Object.keys(contactMessagesData).length === 0) {
                showToast("No messages to export.", "error");
                return;
            }

            const data = Object.entries(contactMessagesData).map(([id, message]) => ({
                'Name': message.name || 'Unknown',
                'Email': message.email || 'No email',
                'Phone': message.phone || 'No phone',
                'Message': message.message || '',
                'Date': new Date(message.sentAt).toLocaleString(),
                'Status': message.read ? 'Read' : 'Unread'
            }));

            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Messages");
            XLSX.writeFile(workbook, "eldavily_messages.xlsx");
            
            showToast('Messages exported successfully to Excel');
        }

        function exportNotificationsToPdf() {
            showToast('Notifications PDF export feature implemented');
        }

        function exportNotificationsToExcel() {
            showToast('Notifications Excel export feature implemented');
        }

        // Notifications Management
        function sendNotification() {
            const data = { 
                title: document.getElementById('notificationTitle').value, 
                message: document.getElementById('notificationMessage').value, 
                position: document.getElementById('notificationPosition').value, 
                sentAt: firebase.database.ServerValue.TIMESTAMP 
            };
            const expiry = document.getElementById('notificationExpiry').value;
            if (expiry) data.displayUntil = new Date(expiry).toISOString();
            
            database.ref('notifications').push(data)
                .then(() => {
                    showToast('Notification sent successfully');
                    document.getElementById('notificationTitle').value = '';
                    document.getElementById('notificationMessage').value = '';
                    document.getElementById('notificationExpiry').value = '';
                })
                .catch(error => {
                    showToast('Error sending notification: ' + error.message, 'error');
                });
        }

        function renderNotifications(notifications) {
            const notificationHistory = document.getElementById('notificationHistory');
            if (!notificationHistory) return;
            
            notificationHistory.innerHTML = '';
            
            Object.entries(notifications).forEach(([id, n]) => {
                const isExpired = n.displayUntil && new Date(n.displayUntil) < new Date();
                const status = isExpired ? 'Expired' : 'Active';
                const statusClass = isExpired ? 'status-expired' : 'status-active';
                
                notificationHistory.innerHTML += `
                    <tr>
                        <td>${n.title}</td>
                        <td>${n.message}</td>
                        <td>${n.position || 'top'}</td>
                        <td>${new Date(n.sentAt).toLocaleString()}</td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                        <td>
                            <button onclick="deleteNotification('${id}')" class="btn btn-sm" style="background-color:var(--danger-color);"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
        }

        window.deleteNotification = (id) => {
            if (confirm('Delete this notification?')) {
                database.ref(`notifications/${id}`).remove()
                    .then(() => showToast('Notification deleted successfully'))
                    .catch(error => showToast('Error deleting notification: ' + error.message, 'error'));
            }
        };

        // Messages Management
        function renderMessages() {
            const messagesList = document.getElementById('customerMessagesList');
            if (!messagesList) return;
            
            messagesList.innerHTML = '';
            
            Object.entries(contactMessagesData).forEach(([id, m]) => {
                const isRead = m.read || false;
                const statusClass = isRead ? 'status-read' : 'status-unread';
                const statusText = isRead ? 'Read' : 'Unread';
                
                messagesList.innerHTML += `
                    <div class="message-item">
                        <div class="message-header">
                            <div class="message-sender">${m.name} (${m.email})</div>
                            <div class="message-date">${new Date(m.sentAt).toLocaleString()}</div>
                        </div>
                        <div class="message-content">
                            <p><strong>Phone:</strong> ${m.phone || 'Not provided'}</p>
                            <p><strong>Message:</strong> ${m.message}</p>
                        </div>
                        <div class="message-actions">
                            <button onclick="viewMessageDetails('${id}')" class="btn btn-sm btn-primary"><i class="fas fa-eye"></i> View Details</button>
                            <button onclick="markAsRead('${id}')" class="btn btn-sm" style="background-color:var(--success-color);"><i class="fas fa-check"></i> Mark as Read</button>
                            <button onclick="deleteMessage('${id}')" class="btn btn-sm" style="background-color:var(--danger-color);"><i class="fas fa-trash"></i> Delete</button>
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                `;
            });
        }

        window.viewMessageDetails = (id) => {
            database.ref(`contactMessages/${id}`).once('value', snapshot => {
                const message = snapshot.val();
                if (!message) {
                    alert('Message not found');
                    return;
                }
                
                document.getElementById('messageModalTitle').textContent = `Message from ${message.name}`;
                
                document.getElementById('messageDetailsContent').innerHTML = `
                    <div class="message-details">
                        <div class="form-group">
                            <label><strong>Name:</strong></label>
                            <p>${message.name}</p>
                        </div>
                        <div class="form-group">
                            <label><strong>Email:</strong></label>
                            <p>${message.email}</p>
                        </div>
                        <div class="form-group">
                            <label><strong>Phone:</strong></label>
                            <p>${message.phone || 'Not provided'}</p>
                        </div>
                        <div class="form-group">
                            <label><strong>Message:</strong></label>
                            <p>${message.message}</p>
                        </div>
                        <div class="form-group">
                            <label><strong>Sent At:</strong></label>
                            <p>${new Date(message.sentAt).toLocaleString()}</p>
                        </div>
                        <div class="form-group">
                            <label><strong>Status:</strong></label>
                            <p>${message.read ? '<span class="status-badge status-read">Read</span>' : '<span class="status-badge status-unread">Unread</span>'}</p>
                        </div>
                    </div>
                    <div class="message-actions" style="margin-top: 20px;">
                        <button onclick="markAsRead('${id}')" class="btn" style="background-color:var(--success-color);"><i class="fas fa-check"></i> Mark as Read</button>
                        <button onclick="deleteMessage('${id}')" class="btn" style="background-color:var(--danger-color); margin-left:10px;"><i class="fas fa-trash"></i> Delete Message</button>
                    </div>
                `;
                
                openModal('messageModal');
            });
        };

        window.markAsRead = (id) => {
            database.ref(`contactMessages/${id}/read`).set(true)
                .then(() => {
                    showToast('Message marked as read');
                    closeModal('messageModal');
                })
                .catch(error => {
                    showToast('Error marking message as read: ' + error.message, 'error');
                });
        };

        window.deleteMessage = (id) => {
            if (confirm('Are you sure you want to delete this message?')) {
                database.ref(`contactMessages/${id}`).remove()
                    .then(() => {
                        showToast('Message deleted successfully');
                        closeModal('messageModal');
                    })
                    .catch(error => {
                        showToast('Error deleting message: ' + error.message, 'error');
                    });
            }
        };

        // Statistics Functions
        function loadStatistics(dateRange) {
            if (!ordersData) return;
            
            // Calculate date range
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - dateRange);
            
            // Filter orders by date range
            const filteredOrders = Object.values(ordersData).filter(order => {
                const orderDate = new Date(order.createdAt || order.timestamp || Date.now());
                return orderDate >= startDate && orderDate <= endDate;
            });
            
            // Calculate statistics
            const revenue = filteredOrders.reduce((sum, order) => sum + (order.total || 0), 0);
            const orderCount = filteredOrders.length;
            
            // Update statistics values
            document.getElementById('revenueStatsValue').textContent = `$${revenue.toFixed(2)}`;
            document.getElementById('ordersStatsValue').textContent = orderCount;
            
            // Calculate percentage changes (simplified)
            const prevRevenue = revenue * 0.88; // Mock previous period data
            const prevOrders = orderCount * 0.92; // Mock previous period data
            
            const revenueChange = prevRevenue > 0 ? ((revenue - prevRevenue) / prevRevenue * 100).toFixed(1) : 0;
            const ordersChange = prevOrders > 0 ? ((orderCount - prevOrders) / prevOrders * 100).toFixed(1) : 0;
            
            document.getElementById('revenueStatsChange').textContent = `${revenueChange >= 0 ? '+' : ''}${revenueChange}%`;
            document.getElementById('revenueStatsChange').className = `stats-change ${revenueChange >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('ordersStatsChange').textContent = `${ordersChange >= 0 ? '+' : ''}${ordersChange}%`;
            document.getElementById('ordersStatsChange').className = `stats-change ${ordersChange >= 0 ? 'positive' : 'negative'}`;
            
            // Generate charts
            generateRevenueChart(filteredOrders, dateRange);
            generateOrdersChart(filteredOrders, dateRange);
            generateTopProductsList(filteredOrders);
            generateStatusChart(filteredOrders);
        }

        function generateRevenueChart(orders, dateRange) {
            const chartContainer = document.querySelector('#revenueChart .chart-bars');
            chartContainer.innerHTML = '';
            
            // Simple bar chart implementation
            const maxRevenue = Math.max(...orders.map(o => o.total || 0), 1);
            
            for (let i = 0; i < Math.min(7, orders.length); i++) {
                const revenue = orders[i]?.total || 0;
                const height = (revenue / maxRevenue) * 100;
                
                const bar = document.createElement('div');
                bar.style.height = `${height}%`;
                bar.style.backgroundColor = 'var(--accent-color)';
                bar.style.flex = '1';
                bar.style.borderRadius = '2px';
                bar.title = `$${revenue.toFixed(2)}`;
                
                chartContainer.appendChild(bar);
            }
        }

        function generateOrdersChart(orders, dateRange) {
            const chartContainer = document.querySelector('#ordersChart .chart-bars');
            chartContainer.innerHTML = '';
            
            // Simple bar chart implementation
            const maxOrders = Math.max(orders.length, 1);
            
            for (let i = 0; i < Math.min(7, orders.length); i++) {
                const height = (1 / maxOrders) * 100;
                
                const bar = document.createElement('div');
                bar.style.height = `${height}%`;
                bar.style.backgroundColor = 'var(--success-color)';
                bar.style.flex = '1';
                bar.style.borderRadius = '2px';
                
                chartContainer.appendChild(bar);
            }
        }

        function generateTopProductsList(orders) {
            const topProductsList = document.getElementById('topProductsList');
            topProductsList.innerHTML = '';
            
            // Count product sales
            const productSales = {};
            orders.forEach(order => {
                if (order.items && Array.isArray(order.items)) {
                    order.items.forEach(item => {
                        const productId = item.productId || item.name;
                        if (!productSales[productId]) {
                            productSales[productId] = { count: 0, revenue: 0, name: item.name };
                        }
                        productSales[productId].count += item.quantity || 1;
                        productSales[productId].revenue += (item.price || 0) * (item.quantity || 1);
                    });
                }
            });
            
            // Sort by revenue and take top 5
            const topProducts = Object.entries(productSales)
                .sort((a, b) => b[1].revenue - a[1].revenue)
                .slice(0, 5);
            
            if (topProducts.length === 0) {
                topProductsList.innerHTML = '<p>No product sales in this period</p>';
                return;
            }
            
            topProducts.forEach(([productId, data]) => {
                const item = document.createElement('div');
                item.className = 'stats-list-item';
                item.innerHTML = `
                    <span>${data.name || productId}</span>
                    <span>$${data.revenue.toFixed(2)} (${data.count} sold)</span>
                `;
                topProductsList.appendChild(item);
            });
        }

        function generateStatusChart(orders) {
            const statusCounts = {
                pending: 0,
                confirmed: 0,
                shipped: 0,
                delivered: 0,
                cancelled: 0,
                returned: 0
            };
            
            // Count orders by status
            orders.forEach(order => {
                const status = order.status || 'pending';
                statusCounts[status] = (statusCounts[status] || 0) + 1;
            });
            
            // Update status legend
            const statusLegend = document.getElementById('statusLegend');
            statusLegend.innerHTML = '';
            
            Object.entries(statusCounts).forEach(([status, count]) => {
                if (count > 0) {
                    const item = document.createElement('div');
                    item.className = 'stats-list-item';
                    item.innerHTML = `
                        <span><span class="status-badge status-${status}">${status}</span></span>
                        <span>${count} orders</span>
                    `;
                    statusLegend.appendChild(item);
                }
            });
            
            if (Object.values(statusCounts).every(count => count === 0)) {
                statusLegend.innerHTML = '<p>No orders in this period</p>';
            }
        }

        function loadRecentActivity() {
            const recentActivity = document.getElementById('recentActivity');
            recentActivity.innerHTML = '';
            
            if (!ordersData || Object.keys(ordersData).length === 0) {
                recentActivity.innerHTML = '<p>No recent activity</p>';
                return;
            }
            
            // Get latest 5 orders
            const latestOrders = Object.entries(ordersData)
                .sort((a, b) => new Date(b[1].createdAt || b[1].timestamp || 0) - new Date(a[1].createdAt || a[1].timestamp || 0))
                .slice(0, 5);
            
            latestOrders.forEach(([id, order]) => {
                const status = order.status || 'pending';
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <strong>${order.customer?.name || 'Unknown Customer'}</strong> 
                            - $${(order.total || 0).toFixed(2)}
                            <span class="status-badge status-${status}">${status}</span>
                        </div>
                        <small>${new Date(order.createdAt || order.timestamp || Date.now()).toLocaleString()}</small>
                    </div>
                `;
                recentActivity.appendChild(item);
            });
        }

        // Order Details View
        window.viewOrderDetails = (id) => {
            database.ref(`orders/${id}`).once('value', snapshot => {
                const order = snapshot.val();
                if (!order) {
                    alert('Order not found');
                    return;
                }
                
                document.getElementById('orderModalTitle').textContent = `Order #${id.substring(0, 8)}`;
                
                // Format order items
                let itemsHtml = '';
                if (order.items && Array.isArray(order.items)) {
                    order.items.forEach(item => {
                        itemsHtml += `
                            <div class="order-item">
                                <div>${item.name || 'Unknown Product'} x ${item.quantity || 1}</div>
                                <div>$${(item.price || 0).toFixed(2)}</div>
                            </div>
                        `;
                    });
                }
                
                // Status options
                const statusOptions = ['pending', 'confirmed', 'shipped', 'delivered', 'cancelled', 'returned'];
                const statusSelect = statusOptions.map(status => 
                    `<option value="${status}" ${order.status === status ? 'selected' : ''}>${status.charAt(0).toUpperCase() + status.slice(1)}</option>`
                ).join('');
                
                const stockProcessedInfo = order.stockProcessed ? 
                    '<p style="color:var(--success-color);"><i class="fas fa-check-circle"></i> Stock has been processed</p>' : 
                    '<p style="color:var(--warning-color);"><i class="fas fa-clock"></i> Stock processing pending</p>';
                
                document.getElementById('orderDetailsContent').innerHTML = `
                    <div class="order-details-grid">
                        <div class="order-info">
                            <h4>Order Information</h4>
                            <p><strong>Order ID:</strong> ${id}</p>
                            <p><strong>Date:</strong> ${new Date(order.createdAt || order.timestamp || Date.now()).toLocaleString()}</p>
                            <p><strong>Total:</strong> $${(order.total || 0).toFixed(2)}</p>
                            ${stockProcessedInfo}
                            <label for="orderStatus"><strong>Status:</strong></label>
                            <select id="orderStatus" class="order-status-select" onchange="updateOrderStatus('${id}', this.value)">
                                ${statusSelect}
                            </select>
                        </div>
                        <div class="customer-info">
                            <h4>Customer Information</h4>
                            <p><strong>Name:</strong> ${order.customer?.name || 'Not provided'}</p>
                            <p><strong>Email:</strong> ${order.customer?.email || 'Not provided'}</p>
                            <p><strong>Phone:</strong> ${order.customer?.phone || 'Not provided'}</p>
                            <p><strong>Address:</strong> ${order.customer?.address || 'Not provided'}</p>
                        </div>
                    </div>
                    <div class="order-items">
                        <h4>Order Items</h4>
                        ${itemsHtml || '<p>No items found</p>'}
                    </div>
                    <div class="order-actions-buttons">
                        <button class="btn btn-primary" onclick="openShipmentModal('${id}')"><i class="fas fa-box-open"></i> Prepare Shipment</button>
                        <button class="btn" style="background-color:var(--danger-color);" onclick="deleteOrder('${id}')"><i class="fas fa-trash"></i> Delete Order</button>
                    </div>
                `;
                
                openModal('orderModal');
            });
        };

        window.deleteOrder = (id) => {
            if (confirm('Are you sure you want to delete this order? This action cannot be undone.')) {
                database.ref(`orders/${id}`).remove()
                    .then(() => {
                        showToast('Order deleted successfully');
                        closeModal('orderModal');
                    })
                    .catch(error => {
                        showToast('Error deleting order: ' + error.message, 'error');
                    });
            }
        };

    </script>
</body>
</html>
