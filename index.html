<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eldavily | Luxury Perfumery</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #2b2b2b;
            --primary-color: #1a1a1a;
            --accent-color: #c9a96d; /* Gold */
            --card-shadow: 0 5px 25px rgba(0, 0, 0, 0.07);
            --font-primary: 'Playfair Display', serif;
            --font-secondary: 'Montserrat', sans-serif;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        /* General Body Styles */
        body {
            font-family: var(--font-secondary);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            line-height: 1.7;
            overflow-x: hidden;
            transition: background-color 0.5s ease;
            scroll-behavior: smooth;
        }

        h1, h2, h3, h4 {
            font-family: var(--font-primary);
            font-weight: 700;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 25px;
        }

        /* Scroll Animations */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease, transform 0.8s ease;
        }
        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Header */
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            background-color: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid #f0f0f0;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: background-color 0.3s;
        }

        .main-header.scrolled {
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .main-header .logo a {
            font-family: var(--font-primary);
            font-size: 32px;
            font-weight: 700;
            text-decoration: none;
            color: var(--primary-color);
            letter-spacing: 1px;
        }

        .main-nav ul {
            margin: 0;
            padding: 0;
            list-style: none;
            display: flex;
            gap: 40px;
        }

        .main-nav a {
            font-size: 16px;
            font-weight: 500;
            color: var(--primary-color);
            text-decoration: none;
            position: relative;
            padding-bottom: 8px;
        }

        .main-nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 1.5px;
            background-color: var(--accent-color);
            transition: width 0.4s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .main-nav a:hover::after {
            width: 100%;
        }
        
        .header-icons {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .header-icons a {
            font-size: 20px;
            color: var(--primary-color);
            cursor: pointer;
            transition: color 0.3s;
            position: relative;
        }
        .header-icons a:hover {
            color: var(--accent-color);
        }

        #cart-icon .cart-count {
            position: absolute;
            top: -8px;
            right: -10px;
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Hero Section */
        .hero-section {
            height: 90vh;
            background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), 
                        var(--hero-bg, url('https://images.unsplash.com/photo-1594035918239-05445b636903?q=80&w=2070&auto=format&fit=crop')) 
                        no-repeat center center/cover;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #fff;
            flex-direction: column;
            transition: background 0.5s ease;
        }
        
        .hero-content h1 {
            font-size: 64px;
            margin: 0;
            font-style: italic;
        }
        
        .hero-content p {
            font-size: 18px;
            margin-bottom: 40px;
            font-weight: 300;
        }

        .btn {
            background-color: transparent;
            color: #fff;
            padding: 14px 40px;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #fff;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #fff;
            color: var(--primary-color);
        }

        /* Products Section */
        .products-section {
            padding: 80px 20px;
        }
        
        .section-title {
            text-align: center;
            font-size: 42px;
            margin-bottom: 50px;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
        }
        
        .product-card {
            background: var(--bg-color);
            text-align: center;
            transition: transform 0.4s ease;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .product-image-wrapper {
            overflow: hidden;
            position: relative;
        }
        
        .product-image {
            width: 100%;
            height: 380px;
            object-fit: cover;
            display: block;
            transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
        }
        
        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-info {
            padding: 25px 0;
        }
        
        .product-info h3 {
            margin: 0 0 10px;
            font-size: 22px;
        }
        
        /* CSS Class for Product Description */
        .product-description {
            font-size: 14px;
            color: #666;
            margin: 10px 0 15px 0;
            padding: 0 15px;
            min-height: 40px;
        }

        .product-price {
            color: var(--text-color);
            font-size: 18px;
            font-weight: 500;
        }

        .product-original-price {
            color: #999;
            text-decoration: line-through;
            font-size: 16px;
            margin-right: 8px;
        }

        .product-sale-badge {
            background-color: var(--danger-color);
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 8px;
        }

        .btn-add {
            background: var(--primary-color);
            color: #fff;
            border: none;
            padding: 12px 30px;
            font-family: var(--font-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
        }

        .btn-add:hover {
            background: var(--accent-color);
            color: white;
        }

        /* Stock Status Styles */
        .stock-status {
            display: block;
            margin-top: 5px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .stock-in {
            color: var(--success-color);
        }
        
        .stock-low {
            color: var(--warning-color);
        }
        
        .stock-out {
            color: var(--danger-color);
        }

        /* CTA Banner */
        .cta-banner {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            background-color: #f7f7f7;
            margin: 60px 0;
        }
        .cta-image { flex: 1 1 50%; }
        .cta-text { flex: 1 1 50%; padding: 80px;}
        .cta-image img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .cta-text h4 { font-weight: normal; font-size: 18px; margin: 0; color: var(--accent-color); font-style: italic;}
        .cta-text h2 { font-size: 48px; margin: 10px 0 20px; }
        .cta-text p { font-size: 16px; margin-bottom: 30px; line-height: 1.8; }
        .cta-text .btn { background-color: var(--primary-color); color: #fff; border-color: var(--primary-color);}
        .cta-text .btn:hover { background-color: var(--accent-color); border-color: var(--accent-color);}

        /* Contact Section */
        .contact-section {
            padding: 80px 20px;
            background-color: #f9f9f9;
        }

        .contact-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 60px;
            align-items: flex-start;
            max-width: 1100px;
            margin: 0 auto;
        }

        .contact-form-container, .contact-whatsapp-container {
            flex: 1;
            min-width: 300px;
        }

        .contact-form-container h3, .contact-whatsapp-container h3 {
            font-size: 28px;
            margin-bottom: 20px;
            font-family: var(--font-primary);
        }
        
        .contact-whatsapp-container p {
            margin-bottom: 30px;
            line-height: 1.8;
        }

        .contact-section .form-group {
            margin-bottom: 20px;
        }

        .contact-section input, .contact-section textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: var(--font-secondary);
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        .contact-section input:focus, .contact-section textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .btn.contact-btn {
            background-color: var(--primary-color);
            color: #fff;
            border: 1px solid var(--primary-color);
            width: 100%;
            padding: 15px 40px;
        }

        .btn.contact-btn:hover {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }

        .btn.whatsapp-btn {
            background-color: var(--primary-color);
            color: #fff;
            border: 1px solid var(--primary-color);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn.whatsapp-btn i {
            font-size: 20px;
        }

        .btn.whatsapp-btn:hover {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            color: #fff;
        }

        .contact-divider {
            display: none;
            text-align: center;
            width: 100%;
            margin: 10px 0;
            font-weight: 500;
            color: #aaa;
            font-family: var(--font-primary);
            font-style: italic;
        }

        /* Footer */
        .main-footer {
            background-color: var(--primary-color);
            padding: 70px 20px 20px;
            color: #a0a0a0;
        }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 40px; margin-bottom: 50px; }
        .footer-col h4 { font-size: 18px; margin-bottom: 20px; color: #fff; }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col ul li { margin-bottom: 12px; }
        .footer-col a { color: #a0a0a0; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent-color); }
        .footer-social a { display: inline-block; font-size: 20px; margin: 0 12px 0 0; color: #fff; }
        .footer-copy { text-align: center; font-size: 14px; padding-top: 30px; border-top: 1px solid #333; }

        /* MODAL & CART STYLES */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .cart-modal {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 450px;
            height: 100%;
            background: white;
            z-index: 2001;
            transition: right 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            display: flex;
            flex-direction: column;
        }
        .cart-modal.active {
            right: 0;
        }

        .cart-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cart-header h3 { margin: 0; font-size: 22px; }
        .cart-header .close-modal { font-size: 24px; cursor: pointer; color: #888; }
        .cart-body { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .cart-item { display: flex; gap: 15px; margin-bottom: 20px; }
        .cart-item img { width: 80px; height: 80px; object-fit: cover; }
        .cart-item-details { flex-grow: 1; }
        .cart-item-details h4 { margin: 0 0 5px; font-size: 16px; }
        .cart-item-details p { margin: 0; color: #666; }
        .cart-item-remove { background: none; border: none; color: #aaa; cursor: pointer; font-size: 14px; }
        .cart-empty-message { text-align: center; color: #888; padding: 40px 0;}

        .cart-footer {
            padding: 20px;
            border-top: 1px solid #eee;
        }
        .cart-subtotal { display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        .cart-discount { display: flex; justify-content: space-between; font-size: 16px; margin-bottom: 10px; color: var(--success-color); }
        .cart-shipping { display: flex; justify-content: space-between; font-size: 16px; margin-bottom: 10px; }
        .cart-total { display: flex; justify-content: space-between; font-size: 20px; font-weight: bold; margin-bottom: 20px; border-top: 1px solid #eee; padding-top: 10px; }
        .coupon-section { margin-bottom: 15px; }
        .coupon-input { display: flex; gap: 10px; }
        .coupon-input input { flex-grow: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .coupon-input button { background: var(--accent-color); color: white; border: none; padding: 0 15px; border-radius: 4px; cursor: pointer; }
        .coupon-error { color: var(--danger-color); font-size: 14px; margin-top: 5px; }
        .coupon-success { color: var(--success-color); font-size: 14px; margin-top: 5px; }
        .btn-checkout {
            display: block; width: 100%; text-align: center; background: var(--primary-color);
            color: white; padding: 15px; text-decoration: none; font-size: 16px;
            font-weight: 500; border: none; cursor: pointer; transition: background 0.3s;
        }
        .btn-checkout:hover { background: var(--accent-color); }
        .btn-checkout:disabled { background: #ccc; cursor: not-allowed; }

        /* Checkout Modal */
        .checkout-modal-content {
            background: white;
            padding: 40px;
            border-radius: 5px;
            width: 90%;
            max-width: 500px;
            z-index: 2002;
            opacity: 0;
            visibility: hidden;
            transform: scale(0.9);
            transition: all 0.4s ease;
            position: relative;
        }
        .modal-overlay.active .checkout-modal-content.active {
            transform: scale(1);
            opacity: 1;
            visibility: visible;
        }
        .checkout-form .form-group { margin-bottom: 15px; }
        .checkout-form label { display: block; margin-bottom: 5px; font-weight: 500; }
        .checkout-form input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 3px; font-family: var(--font-secondary); box-sizing: border-box; }
        .btn-place-order {
             display: block; width: 100%; text-align: center; background: var(--primary-color);
            color: white; padding: 15px; text-decoration: none; font-size: 16px;
            font-weight: 500; border: none; cursor: pointer; transition: background 0.3s; margin-top: 20px;
        }
        .order-confirmation { text-align: center; }
        .order-confirmation i { font-size: 50px; color: #28a745; margin-bottom: 20px; }

        /* Notification Styles */
        .notification-banner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            background: var(--accent-color);
            color: white;
            text-align: center;
            z-index: 2002;
            opacity: 0;
            transition: opacity 0.5s ease;
            position: relative;
        }
        .notification-banner.show {
            opacity: 1;
        }
        /* Style for top position */
        .notification-banner-top {
            width: 100%;
        }
        /* Style for bottom position */
        .notification-banner-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
        }
        .notification-banner .close-notification {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        /* Product Categories */
        .categories-section {
            padding: 40px 20px;
            background-color: #f9f9f9;
        }
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .category-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            text-align: center;
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        .category-card:hover {
            transform: translateY(-5px);
        }
        .category-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .category-name {
            padding: 15px;
            font-weight: 500;
        }

        /* Responsive Styles */
        @media (max-width: 820px) {
             .contact-wrapper {
                flex-direction: column;
                gap: 20px;
            }
            .contact-divider {
                display: block;
            }
            .contact-form-container, .contact-whatsapp-container {
                text-align: center;
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .main-header {
                padding: 15px 20px;
                flex-wrap: wrap;
            }
            .main-nav { display: none; }
            .hero-content h1 { font-size: 42px; }
            .cta-banner { flex-direction: column; }
            .cta-text { padding: 40px; }
            .products-grid { grid-template-columns: 1fr; }
            .categories-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

    <div id="notification-container"></div>

    <header class="main-header" id="mainHeader">
        <div class="logo">
            <a href="#">ELDAVILY</a>
        </div>
        <nav class="main-nav">
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#products">Fragrances</a></li>
                <li><a href="#categories">Categories</a></li>
                <li><a href="#">Our Story</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
        <div class="header-icons">
            <a href="#"><i class="fas fa-search"></i></a>
            <a href="#"><i class="far fa-user"></i></a>
            <a href="#" id="cart-icon">
                <i class="fas fa-shopping-bag"></i>
                <span class="cart-count">0</span>
            </a>
        </div>
    </header>

    <main>
        <section class="hero-section" id="heroSection">
            <div class="hero-content reveal visible">
                <h1 id="heroTitle">The Essence of You</h1>
                <p id="heroSubtitle">Discover a collection of scents that tell your unique story.</p>
                <a href="#products" class="btn" id="heroButton">Explore Collection</a>
            </div>
        </section>

        <section id="categories" class="categories-section container">
            <h2 class="section-title reveal">Shop By Category</h2>
            <div class="categories-grid" id="categoriesGrid">
                </div>
        </section>

        <section id="products" class="products-section container">
            <h2 class="section-title reveal">Our Exclusive Collection</h2>
            
            <div class="products-grid" id="productsGrid"></div>
        </section>
        
        <section class="cta-banner reveal" id="ctaSection">
            <div class="cta-image"><img src="https://images.unsplash.com/photo-1557777586-f6682739fcf3?q=80&w=2070" alt="Model with perfume"></div>
            <div class="cta-text"><h4 id="ctaPreTitle">Eldavily Bespoke</h4><h2 id="ctaTitle">Crafted For The Connoisseur</h2><p id="ctaDescription">Experience the art of perfumery. Each fragrance is composed of the world's finest ingredients, creating a scent that is both timeless and unforgettable.</p><a href="#" class="btn" id="ctaButton">Discover Our Craft</a></div>
        </section>
        
        <section class="products-section container">
            <h2 class="section-title reveal">Our Bestsellers</h2>
            <div class="products-grid" id="bestsellersGrid"></div>
        </section>

        <section id="contact" class="contact-section">
            <div class="container">
                <h2 class="section-title reveal">Get In Touch</h2>
                <div class="contact-wrapper reveal">
                    <div class="contact-form-container">
                        <h3>Send us a Message</h3>
                        <form id="contactForm">
                            <div class="form-group">
                                <input type="text" id="contactName" name="name" placeholder="Your Name" required>
                            </div>
                            <div class="form-group">
                                <input type="email" id="contactEmail" name="email" placeholder="Your Email" required>
                            </div>
                            <div class="form-group">
                                <input type="tel" id="contactPhone" name="phone" placeholder="Your Phone (Optional)">
                            </div>
                            <div class="form-group">
                                <textarea id="contactMessage" name="message" placeholder="Your Message" rows="5" required></textarea>
                            </div>
                            <button type="submit" class="btn contact-btn">Send Message</button>
                        </form>
                    </div>
                    <div class="contact-divider">
                        <span>OR</span>
                    </div>
                    <div class="contact-whatsapp-container">
                        <h3>Contact us on WhatsApp</h3>
                        <p>For a quicker response, click the button below to start a chat with our team directly on WhatsApp.</p>
                        <a href="https://wa.me/message/TM3CWFG4CZZXN1" target="_blank" class="btn whatsapp-btn">
                            <i class="fab fa-whatsapp"></i> Chat on WhatsApp
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>ELDAVILY</h4>
                    <p>The art of fine perfumery, reimagined for the modern soul. Crafted with passion, worn with purpose.</p>
                </div>
                <div class="footer-col">
                    <h4>Explore</h4>
                    <ul>
                        <li><a href="#">New Arrivals</a></li>
                        <li><a href="#">Gifting</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#contact">Contact Us</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Follow Us</h4>
                    <div class="footer-social">
                        <a href="https://www.instagram.com/eldavily?igsh=dGdmZTl3ZWttZTdh" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-copy">
                <p>&copy; 2025 ELDAVILY. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <div class="modal-overlay" id="modalOverlay">
        <div class="cart-modal" id="cartModal">
            <div class="cart-header">
                <h3>Your Bag</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="cart-body"></div>
            <div class="cart-footer">
                <div class="coupon-section">
                    <div class="coupon-input">
                        <input type="text" id="couponCode" placeholder="Enter coupon code">
                        <button id="applyCoupon">Apply</button>
                    </div>
                    <div id="couponMessage" class="coupon-error"></div>
                </div>
                <div class="cart-subtotal">
                    <span>Subtotal</span>
                    <span id="cart-subtotal-price">0.00 MAD</span>
                </div>
                <div class="cart-discount" id="discountSection" style="display: none;">
                    <span>Discount</span>
                    <span id="discount-amount">-0.00 MAD</span>
                </div>
                <div class="cart-shipping" id="shippingSection">
                    <span>Standard Shipping</span>
                    <span id="shipping-cost">0.00 MAD</span>
                </div>
                <div class="cart-total">
                    <span>Total</span>
                    <span id="cart-total-price">0.00 MAD</span>
                </div>
                <button class="btn-checkout" id="checkoutBtn" disabled>Proceed to Checkout</button>
            </div>
        </div>
        <div class="checkout-modal-content" id="checkoutModal">
            <span class="close-modal" style="position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer;">&times;</span>
            <div id="checkout-form-container">
                <h3 style="text-align: center; margin-bottom: 25px;">Shipping Details</h3>
                <form id="checkout-form" class="checkout-form">
                    <div class="form-group">
                        <label for="name">Full Name *</label>
                        <input type="text" id="name" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Address *</label>
                        <input type="text" id="address" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input type="tel" id="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email (Optional)</label>
                        <input type="email" id="email">
                    </div>
                    <button type="submit" class="btn-place-order">Place Order</button>
                </form>
            </div>
            <div id="order-confirmation-container" class="order-confirmation" style="display: none;">
                <i class="fas fa-check-circle"></i>
                <h2>Thank You!</h2>
                <p>Your order has been placed successfully.</p>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDuaP43jD8LWw5A8cIbcgS7-bqCZTXzEEg",
            authDomain: "davily-feded.firebaseapp.com",
            databaseURL: "https://davily-feded-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "davily-feded",
            storageBucket: "davily-feded.appspot.com",
            messagingSenderId: "83255410493",
            appId: "1:83255410493:web:927c5e859c5b20805c4f54",
            measurementId: "G-LD4XHS6FGM"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let cart = [];
        let productsData = {};
        let categoriesData = {};
        let couponsData = {};
        let appliedCoupon = null;
        let shippingSettings = {
            baseCost: 5,
            increaseThreshold: 2,
            increasePercentage: 10
        };

        function loadStoreData() {
            // Load background settings
            database.ref('admin/background').on('value', snapshot => {
                const bg = snapshot.val();
                if (bg) {
                    if (bg.type === 'image' && bg.imageUrl) {
                        document.getElementById('heroSection').style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(${bg.imageUrl})`;
                    } else if (bg.type === 'color') {
                        document.getElementById('heroSection').style.background = bg.color;
                    } else if (bg.type === 'gradient' && bg.gradientColors) {
                        document.getElementById('heroSection').style.background = `linear-gradient(135deg, ${bg.gradientColors})`;
                    }
                }
            });

            // Load hero content
            database.ref('admin/heroContent').on('value', snapshot => {
                const content = snapshot.val();
                if (content) {
                    document.getElementById('heroTitle').textContent = content.title || 'The Essence of You';
                    document.getElementById('heroSubtitle').textContent = content.subtitle || 'Discover scents that tell your story.';
                    document.getElementById('heroButton').textContent = content.buttonText || 'Explore Collection';
                }
            });

            // Load products
            database.ref('products').on('value', snapshot => {
                productsData = snapshot.val() || {};
                renderProducts(productsData);
                renderBestsellers(productsData);
            });

            // Load categories
            database.ref('categories').on('value', snapshot => {
                categoriesData = snapshot.val() || {};
                renderCategories(categoriesData);
            });

            // Load coupons
            database.ref('coupons').on('value', snapshot => {
                couponsData = snapshot.val() || {};
            });

            // Load shipping settings
            database.ref('admin/shippingSettings').on('value', snapshot => {
                const settings = snapshot.val();
                if (settings) {
                    shippingSettings = {
                        baseCost: settings.baseCost || 5,
                        increaseThreshold: settings.increaseThreshold || 2,
                        increasePercentage: settings.increasePercentage || 10
                    };
                }
                updateCartUI(); // Update cart to reflect new shipping costs
            });

            trackStoreVisit();
        }

        function calculateShippingCost() {
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            
            if (totalItems === 0) return 0;
            
            let shippingCost = shippingSettings.baseCost;
            
            // Increase shipping cost if items exceed threshold
            if (totalItems > shippingSettings.increaseThreshold) {
                const extraItems = totalItems - shippingSettings.increaseThreshold;
                const increaseAmount = shippingCost * (shippingSettings.increasePercentage / 100);
                shippingCost += extraItems * increaseAmount;
            }
            
            return parseFloat(shippingCost.toFixed(2));
        }

        function loadNotifications() {
            database.ref('notifications').orderByChild('sentAt').on('value', snapshot => {
                const notificationsData = snapshot.val();
                const container = document.getElementById('notification-container');
                container.innerHTML = '';
                if (!notificationsData) return;
                
                const now = new Date();
                const activeNotifications = Object.values(notificationsData).filter(n => !n.displayUntil || new Date(n.displayUntil) > now);
                
                if (activeNotifications.length > 0) {
                    const latest = activeNotifications[activeNotifications.length - 1];
                    const banner = document.createElement('div');
                    banner.className = `notification-banner notification-banner-${latest.position || 'top'}`;
                    banner.innerHTML = `<span>${latest.title}: ${latest.message}</span><button class="close-notification">&times;</button>`;
                    container.appendChild(banner);
                    banner.querySelector('.close-notification').onclick = () => banner.remove();
                    setTimeout(() => banner.classList.add('show'), 100);
                }
            });
        }

        function renderCategories(categories) {
            const categoriesGrid = document.getElementById('categoriesGrid');
            categoriesGrid.innerHTML = '';
            
            if (!categories) return;
            
            Object.keys(categories).forEach(id => {
                const category = categories[id];
                if (category.status !== 'active') return;
                
                const categoryHTML = `
                    <div class="category-card reveal" data-category="${id}">
                        <img src="${category.imageUrl || 'https://images.unsplash.com/photo-1594035918239-05445b636903?q=80&w=2070'}" alt="${category.name}" class="category-image">
                        <div class="category-name">${category.name}</div>
                    </div>
                `;
                
                categoriesGrid.innerHTML += categoryHTML;
            });
            
            // Add event listeners to category cards
            document.querySelectorAll('.category-card').forEach(card => {
                card.addEventListener('click', () => {
                    const categoryId = card.dataset.category;
                    filterProductsByCategory(categoryId);
                });
            });
            
            triggerRevealAnimations();
        }

        function filterProductsByCategory(categoryId) {
            const filteredProducts = {};
            
            Object.keys(productsData).forEach(id => {
                const product = productsData[id];
                if (product.category === categoryId && product.status === 'active') {
                    filteredProducts[id] = product;
                }
            });
            
            renderProducts(filteredProducts);
        }

        function renderProducts(products) {
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';
            if (!products) return;
            
            Object.keys(products).forEach(id => {
                const p = products[id];
                // Skip products that are not active
                if (p.status && p.status !== 'active') return;
                
                const stockStatus = getStockStatus(p.stock, p.lowStockAlert);
                const saleBadge = p.salePrice ? `<span class="product-sale-badge">SALE</span>` : '';
                const priceDisplay = p.salePrice ? 
                    `<span class="product-original-price">${Number(p.price).toFixed(2)} MAD</span> <span class="product-price">${Number(p.salePrice).toFixed(2)} MAD</span>` :
                    `<span class="product-price">${Number(p.price).toFixed(2)} MAD</span>`;
                
                const cardHTML = `
                    <div class="product-card reveal" data-category="${p.category || ''}">
                        <div class="product-image-wrapper">
                            <img src="${p.imageUrl || ''}" alt="${p.name}" class="product-image">
                        </div>
                        <div class="product-info">
                            <h3>${p.name} ${saleBadge}</h3>
                            <p class="product-description">${p.description || 'No description available.'}</p>
                            ${priceDisplay}
                            <span class="stock-status ${stockStatus.class}">${stockStatus.text}</span>
                        </div>
                        <button class="btn-add" data-id="${id}" data-name="${p.name}" data-price="${p.salePrice || p.price}" data-image="${p.imageUrl || ''}" ${p.stock <= 0 ? 'disabled' : ''}>
                            ${p.stock <= 0 ? 'Out of Stock' : 'Add to Cart'}
                        </button>
                    </div>
                `;
                
                productsGrid.innerHTML += cardHTML;
            });
            
            document.querySelectorAll('#productsGrid .btn-add').forEach(b => {
                if (!b.disabled) {
                    b.addEventListener('click', handleAddToCart);
                }
            });
            triggerRevealAnimations();
        }

        function renderBestsellers(products) {
            const bestsellersGrid = document.getElementById('bestsellersGrid');
            bestsellersGrid.innerHTML = '';
            if (!products) return;
            
            // Find products marked as bestsellers
            const bestsellers = Object.keys(products)
                .filter(id => products[id].bestseller === true && products[id].status === 'active')
                .slice(0, 4); // Show only 4 bestsellers
            
            bestsellers.forEach(id => {
                const p = products[id];
                const stockStatus = getStockStatus(p.stock, p.lowStockAlert);
                const saleBadge = p.salePrice ? `<span class="product-sale-badge">SALE</span>` : '';
                const priceDisplay = p.salePrice ? 
                    `<span class="product-original-price">${Number(p.price).toFixed(2)} MAD</span> <span class="product-price">${Number(p.salePrice).toFixed(2)} MAD</span>` :
                    `<span class="product-price">${Number(p.price).toFixed(2)} MAD</span>`;
                
                const cardHTML = `
                    <div class="product-card reveal">
                        <div class="product-image-wrapper">
                            <img src="${p.imageUrl || ''}" alt="${p.name}" class="product-image">
                        </div>
                        <div class="product-info">
                            <h3>${p.name} ${saleBadge}</h3>
                            <p class="product-description">${p.description || 'No description available.'}</p>
                            ${priceDisplay}
                            <span class="stock-status ${stockStatus.class}">${stockStatus.text}</span>
                        </div>
                        <button class="btn-add" data-id="${id}" data-name="${p.name}" data-price="${p.salePrice || p.price}" data-image="${p.imageUrl || ''}" ${p.stock <= 0 ? 'disabled' : ''}>
                            ${p.stock <= 0 ? 'Out of Stock' : 'Add to Cart'}
                        </button>
                    </div>
                `;
                
                bestsellersGrid.innerHTML += cardHTML;
            });
            
            document.querySelectorAll('#bestsellersGrid .btn-add').forEach(b => {
                if (!b.disabled) {
                    b.addEventListener('click', handleAddToCart);
                }
            });
            triggerRevealAnimations();
        }

        function getStockStatus(stock, lowStockAlert = 5) {
            if (stock <= 0) {
                return { class: 'stock-out', text: 'Out of Stock' };
            } else if (stock <= lowStockAlert) {
                return { class: 'stock-low', text: 'Low Stock' };
            } else {
                return { class: 'stock-in', text: 'In Stock' };
            }
        }

        function handleAddToCart(e) {
            const { id, name, price, image } = e.target.dataset;
            const product = productsData[id];
            
            // Check if product is in stock
            if (product && product.stock <= 0) {
                alert('Sorry, this product is out of stock.');
                return;
            }
            
            // Check if product is active
            if (product && product.status !== 'active') {
                alert('Sorry, this product is currently unavailable.');
                return;
            }
            
            // Check if product already in cart
            const existingItem = cart.find(item => item.id === id);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ 
                    id, 
                    name, 
                    price: parseFloat(price), 
                    image,
                    quantity: 1 
                });
            }
            
            updateCartUI();
            e.target.textContent = 'Added!';
            setTimeout(() => { 
                e.target.textContent = 'Add to Cart'; 
            }, 1500);
        }

        function updateCartUI() {
            const cartBody = document.querySelector('.cart-body');
            const subtotalEl = document.getElementById('cart-subtotal-price');
            const totalEl = document.getElementById('cart-total-price');
            const shippingEl = document.getElementById('shipping-cost');
            const countEl = document.querySelector('.cart-count');
            const checkoutBtn = document.getElementById('checkoutBtn');
            cartBody.innerHTML = '';
            
            if (cart.length === 0) {
                cartBody.innerHTML = '<div class="cart-empty-message">Your bag is empty.</div>';
                checkoutBtn.disabled = true;
                appliedCoupon = null;
                updateCartTotals();
            } else {
                cart.forEach((item, index) => {
                    cartBody.innerHTML += `
                        <div class="cart-item">
                            <img src="${item.image}" alt="${item.name}">
                            <div class="cart-item-details">
                                <h4>${item.name}</h4>
                                <p>${item.price.toFixed(2)} MAD x ${item.quantity}</p>
                                <p>${(item.price * item.quantity).toFixed(2)} MAD</p>
                            </div>
                            <button class="cart-item-remove" data-index="${index}">&times; Remove</button>
                        </div>
                    `;
                });
                
                document.querySelectorAll('.cart-item-remove').forEach(b => {
                    b.addEventListener('click', e => {
                        cart.splice(e.target.dataset.index, 1);
                        updateCartUI();
                    });
                });
                checkoutBtn.disabled = false;
            }
            
            updateCartTotals();
            countEl.textContent = cart.reduce((total, item) => total + item.quantity, 0);
        }

        function updateCartTotals() {
            const subtotalEl = document.getElementById('cart-subtotal-price');
            const totalEl = document.getElementById('cart-total-price');
            const shippingEl = document.getElementById('shipping-cost');
            const discountSection = document.getElementById('discountSection');
            const discountAmountEl = document.getElementById('discount-amount');
            
            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            const shippingCost = calculateShippingCost();
            
            let discount = 0;
            if (appliedCoupon) {
                discount = subtotal * (appliedCoupon.discount / 100);
            }
            
            const total = subtotal - discount + shippingCost;
            
            subtotalEl.textContent = `${subtotal.toFixed(2)} MAD`;
            shippingEl.textContent = `${shippingCost.toFixed(2)} MAD`;
            totalEl.textContent = `${total.toFixed(2)} MAD`;
            
            if (discount > 0) {
                discountSection.style.display = 'flex';
                discountAmountEl.textContent = `-${discount.toFixed(2)} MAD`;
            } else {
                discountSection.style.display = 'none';
            }
        }

        function setupModals() {
            const overlay = document.getElementById('modalOverlay');
            const cartModal = document.getElementById('cartModal');
            const checkoutModal = document.getElementById('checkoutModal');
            
            const openCart = () => { 
                overlay.classList.add('active'); 
                cartModal.classList.add('active'); 
                checkoutModal.classList.remove('active'); 
            };
            
            const openCheckout = () => { 
                if (cart.length === 0) return; 
                cartModal.classList.remove('active'); 
                checkoutModal.classList.add('active'); 
                document.getElementById('checkout-form-container').style.display = 'block'; 
                document.getElementById('order-confirmation-container').style.display = 'none'; 
            };
            
            const closeModal = () => { 
                overlay.classList.remove('active'); 
                cartModal.classList.remove('active'); 
                checkoutModal.classList.remove('active'); 
            };
            
            document.getElementById('cart-icon').addEventListener('click', e => { 
                e.preventDefault(); 
                openCart(); 
            });
            
            document.getElementById('checkoutBtn').addEventListener('click', openCheckout);
            document.querySelectorAll('.close-modal').forEach(b => b.addEventListener('click', closeModal));
            overlay.addEventListener('click', e => { if (e.target === overlay) closeModal(); });
            
            // Coupon application
            document.getElementById('applyCoupon').addEventListener('click', applyCoupon);
            document.getElementById('couponCode').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    applyCoupon();
                }
            });
            
            document.getElementById('checkout-form').addEventListener('submit', handlePlaceOrder);
        }

        function applyCoupon() {
            const couponCode = document.getElementById('couponCode').value.toUpperCase();
            const couponMessage = document.getElementById('couponMessage');
            
            if (!couponCode) {
                couponMessage.textContent = 'Please enter a coupon code';
                couponMessage.className = 'coupon-error';
                return;
            }
            
            if (couponsData[couponCode]) {
                appliedCoupon = {
                    code: couponCode,
                    discount: couponsData[couponCode]
                };
                couponMessage.textContent = `Coupon applied! ${appliedCoupon.discount}% discount`;
                couponMessage.className = 'coupon-success';
                updateCartTotals();
            } else {
                couponMessage.textContent = 'Invalid coupon code';
                couponMessage.className = 'coupon-error';
                appliedCoupon = null;
                updateCartTotals();
            }
        }

        function handlePlaceOrder(e) {
            e.preventDefault();
            
            // Check stock before placing order
            let outOfStockItems = [];
            cart.forEach(item => {
                const product = productsData[item.id];
                if (product && product.stock <= 0) {
                    outOfStockItems.push(item.name);
                }
            });
            
            if (outOfStockItems.length > 0) {
                alert(`Sorry, the following items are no longer available: ${outOfStockItems.join(', ')}`);
                cart = cart.filter(item => !outOfStockItems.includes(item.name));
                updateCartUI();
                return;
            }
            
            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            const discount = appliedCoupon ? subtotal * (appliedCoupon.discount / 100) : 0;
            const shippingCost = calculateShippingCost();
            const total = subtotal - discount + shippingCost;
            
            const orderData = { 
                customer: { 
                    name: document.getElementById('name').value, 
                    address: document.getElementById('address').value, 
                    phone: document.getElementById('phone').value,
                    email: document.getElementById('email').value || '' // Email is optional
                }, 
                items: cart,
                subtotal: subtotal,
                discount: discount,
                shipping: shippingCost,
                total: total,
                coupon: appliedCoupon ? appliedCoupon.code : null,
                status: 'pending', 
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                stockProcessed: false
            };
            
            database.ref('orders').push(orderData).then(() => {
                document.getElementById('checkout-form-container').style.display = 'none';
                document.getElementById('order-confirmation-container').style.display = 'block';
                cart = [];
                appliedCoupon = null;
                updateCartUI();
                setTimeout(() => document.getElementById('modalOverlay').classList.remove('active'), 4000);
            }).catch(error => alert("Order failed: " + error.message));
        }
        
        function handleContactForm(e) {
            e.preventDefault();
            const contactData = {
                name: document.getElementById('contactName').value,
                email: document.getElementById('contactEmail').value,
                phone: document.getElementById('contactPhone').value,
                message: document.getElementById('contactMessage').value,
                sentAt: firebase.database.ServerValue.TIMESTAMP,
                read: false
            };
            database.ref('contactMessages').push(contactData).then(() => {
                alert('Thank you for your message! We will get back to you soon.');
                document.getElementById('contactForm').reset();
            }).catch(error => {
                alert('An error occurred. Please try again. Error: ' + error.message);
            });
        }

        function trackStoreVisit() {
            const today = new Date().toISOString().split('T')[0];
            database.ref(`analytics/storeVisits/${today}`).transaction(c => (c || 0) + 1);
        }

        function triggerRevealAnimations() {
            document.querySelectorAll('.reveal').forEach(el => {
                if (el.getBoundingClientRect().top < window.innerHeight - 100) el.classList.add('visible');
            });
        }

        window.addEventListener('scroll', () => {
            document.getElementById('mainHeader').classList.toggle('scrolled', window.scrollY > 50);
            triggerRevealAnimations();
        });

        document.addEventListener('DOMContentLoaded', () => {
            loadStoreData();
            loadNotifications();
            setupModals();
            updateCartUI();
            triggerRevealAnimations();
            document.getElementById('contactForm').addEventListener('submit', handleContactForm);
        });
    </script>
</body>
</html>
